<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Compatibility Report Export (Dark)</title>
</head>
<body>
<!-- (Optional) Example button & table skeleton (keep your own if you already have them)
<button id="downloadBtn">Download Compatibility PDF</button>
<table id="compatibilityTable">
  <thead>
    <tr>
      <th>Category</th><th>Partner A</th><th>Match</th><th>Flag</th><th>Partner B</th>
    </tr>
  </thead>
  <tbody><!-- your rows here --></tbody>
</table>
-->

<!-- === TalkKink Compatibility Report Export ===
STEPS:
1. Paste this <script> block just before </body>.
2. Ensure your table has id="compatibilityTable".
3. Add a button with id="downloadBtn" (or #downloadPdfBtn / [data-download-pdf]).
   If you don’t, this script creates one for you.
4. Click the button to export a full-width, black-background, white-text PDF.
-->

<script>
(function () {
  async function inject(src){
    return new Promise((res,rej)=>{
      if(document.querySelector(`script[src="${src}"]`))return res();
      const s=document.createElement("script");s.src=src;s.onload=res;s.onerror=()=>rej();document.head.appendChild(s);
    });
  }
  async function ensureLibs(){
    if(!(window.jspdf&&window.jspdf.jsPDF)){
      await inject("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js");
    }
    if(!((window.jspdf&&window.jspdf.autoTable)||(window.jsPDF&&window.jsPDF.API&&window.jsPDF.API.autoTable))){
      await inject("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js");
    }
  }
  function runAutoTable(doc,opts){
    if(typeof doc.autoTable==="function") return doc.autoTable(opts);
    return window.jspdf.autoTable(doc,opts);
  }

  function getRows(){
    const table=document.getElementById("compatibilityTable")||document.querySelector("table");
    if(!table)return[];
    const trs=[...table.querySelectorAll("tbody tr")];
    const out=[];
    for(const tr of trs){
      const tds=[...tr.querySelectorAll("td")];if(!tds.length)continue;
      out.push(tds.map(td=>td.textContent.trim()));
    }
    return out;
  }

  async function exportPDF(){
    await ensureLibs();
    const { jsPDF }=window.jspdf;
    const doc=new jsPDF({orientation:"landscape",unit:"pt",format:"a4"});

    const rows=getRows();
    if(!rows.length){alert("No rows to export.");return;}

    doc.setFillColor(0,0,0);
    doc.rect(0,0,doc.internal.pageSize.width,doc.internal.pageSize.height,"F");
    doc.setTextColor(255,255,255);
    doc.setFontSize(24);
    doc.text("Talk Kink • Compatibility Report", doc.internal.pageSize.width/2, 50, {align:"center"});

    runAutoTable(doc,{
      head:[["Category","Partner A","Match","Flag","Partner B"]],
      body:rows,
      startY:80,
      theme:"plain",
      styles:{fontSize:12,fillColor:[0,0,0],textColor:[255,255,255],halign:"center",valign:"middle"},
      headStyles:{fillColor:[0,0,0],textColor:[255,255,255],fontStyle:"bold"},
      tableWidth:"auto",
      columnStyles:{
        0:{cellWidth:doc.internal.pageSize.width*0.5,halign:"left",fontStyle:"bold"},
        1:{cellWidth:doc.internal.pageSize.width*0.12},
        2:{cellWidth:doc.internal.pageSize.width*0.12},
        3:{cellWidth:doc.internal.pageSize.width*0.1},
        4:{cellWidth:doc.internal.pageSize.width*0.12}
      },
      margin:{left:40,right:40}
    });

    doc.save("compatibility-report.pdf");
  }

  function bind(){
    let btn=document.querySelector("#downloadBtn,#downloadPdfBtn,[data-download-pdf]");
    if(!btn){
      btn=document.createElement("button");
      btn.id="downloadBtn";
      btn.textContent="Download Compatibility PDF";
      document.body.appendChild(btn);
    }
    btn.onclick=exportPDF;
  }
  if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",bind);else bind();
})();
</script>
</body>
</html>
