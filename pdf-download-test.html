<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Download Test</title>
  <!-- PDF libraries will be loaded on demand -->
</head>
<body>
  <button id="downloadBtn">Download PDF</button>

  <div id="pdf-container">
    <h1>PDF Export Test</h1>
    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Partner A</th>
          <th>Match %</th>
          <th>Partner B</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Appearance Play</td>
          <td>5</td>
          <td>100%</td>
          <td>5</td>
        </tr>
        <tr>
          <td>Choosing my partner’s outfit for the day</td>
          <td>5</td>
          <td>100%</td>
          <td>5</td>
        </tr>
        <tr>
          <td>Selecting underwear/lingerie</td>
          <td>1</td>
          <td>80%</td>
          <td>0</td>
        </tr>
      </tbody>
    </table>
  </div>
  <script>
async function loadScript(url) {
  return new Promise((resolve, reject) => {
    if (document.querySelector(`script[src="${url}"]`)) return resolve();
    const s = document.createElement("script");
    s.src = url;
    s.onload = resolve;
    s.onerror = reject;
    document.head.appendChild(s);
  });
}

async function setupPDFExport() {
  await loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js");
  await loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js");

  async function downloadDarkPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });

    const pageW = doc.internal.pageSize.getWidth();
    const pageH = doc.internal.pageSize.getHeight();

    // Paint the whole page black
    const paintPage = () => {
      doc.setFillColor(0, 0, 0);
      doc.rect(0, 0, pageW, pageH, 'F');
      doc.setTextColor(255, 255, 255);
    };

    paintPage();

    // Title
    doc.setFontSize(28);
    doc.text("Talk Kink • Compatibility Report", pageW / 2, 40, { align: "center" });

    // Example table body
    const body = [
      ["Appearance Play", "5", "100%", "5"],
      ["Choosing my partner’s outfit for the day", "5", "100%", "5"],
      ["Selecting underwear/lingerie", "1", "80%", "0"]
    ];

    // Draw table
    doc.autoTable({
      head: [["Category", "Partner A", "Match %", "Partner B"]],
      body,
      startY: 60,
      styles: {
        fontSize: 11,
        cellPadding: 6,
        textColor: [255, 255, 255],
        fillColor: [0, 0, 0],
        lineColor: [255, 255, 255],
        lineWidth: 0.25
      },
      headStyles: {
        fillColor: [0, 0, 0],
        textColor: [255, 255, 255],
        fontStyle: "bold",
        lineColor: [255, 255, 255],   // white header borders
        lineWidth: 0.5
      },
      columnStyles: {
        0: { cellWidth: 420, halign: "left" },
        1: { cellWidth: 80, halign: "center" },
        2: { cellWidth: 90, halign: "center" },
        3: { cellWidth: 80, halign: "center" }
      },
      tableLineColor: [255, 255, 255],
      tableLineWidth: 0.5,
      didDrawPage: paintPage
    });

    doc.save("compatibility-dark.pdf");
  }

  const btn = document.querySelector("#downloadBtn, #downloadPdfBtn, [data-download-pdf]");
  if (btn) btn.addEventListener("click", downloadDarkPDF);
  else console.warn("No download button found.");
}

document.addEventListener("DOMContentLoaded", setupPDFExport);
</script>
</body>
</html>
