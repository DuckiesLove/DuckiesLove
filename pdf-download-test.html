<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Download Test</title>
  <!-- PDF libraries will be loaded on demand -->
</head>
<body>
  <button id="downloadBtn">Download PDF</button>

  <div id="pdf-container">
    <h1>PDF Export Test</h1>
    <table>
      <thead>
        <tr>
          <th>Column 1</th>
          <th>Column 2</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Cell 1</td>
          <td>Cell 2</td>
        </tr>
      </tbody>
    </table>
  </div>
  <script>
async function loadScript(url) {
  return new Promise((resolve, reject) => {
    if (document.querySelector(`script[src="${url}"]`)) return resolve();
    const s = document.createElement("script");
    s.src = url;
    s.onload = resolve;
    s.onerror = reject;
    document.head.appendChild(s);
  });
}

async function setupPDFExport() {
  await loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js");
  await loadScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js");

  const { jsPDF } = window.jspdf;

  function generatePDF() {
    const doc = new jsPDF("p", "pt", "a4");
    doc.setFontSize(16);
    doc.text("Talk Kink â€¢ Compatibility Report", 40, 40);

    // Build headers + body manually to avoid duplication
    const headers = [];
    const headCells = document.querySelectorAll("table thead tr th");
    headCells.forEach(th => headers.push(th.textContent.trim()));

    const body = [];
    document.querySelectorAll("table tbody tr").forEach(row => {
      const rowData = [];
      row.querySelectorAll("td").forEach(td => rowData.push(td.textContent.trim()));
      body.push(rowData);
    });

    doc.autoTable({
      head: [headers],
      body: body,
      startY: 60,
      theme: "grid",
      styles: { fontSize: 10, cellPadding: 5 },
      headStyles: { fillColor: [0, 0, 0], textColor: [255, 255, 255] }
    });

    doc.save("compatibility_report.pdf");
  }

  const btn = document.querySelector("#downloadBtn, #downloadPdfBtn, [data-download-pdf]");
  if (btn) btn.addEventListener("click", generatePDF);
  else console.warn("No download button found.");
}

document.addEventListener("DOMContentLoaded", setupPDFExport);
</script>
</body>
</html>
