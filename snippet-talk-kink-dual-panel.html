<!-- ================== TALK KINK — DUAL PANEL QUESTION CARD + COLORFUL SCALE ================== -->
<script>
/* ======================= JS — create right panel + sync ======================= */
(function TKDualPanel(){
  const $ = (s, r=document) => r.querySelector(s);

  function ensureHostAndPanels(){
    const host = $('#tk-question-host') || document.body;
    host.classList.add('tk-dual');

    if (!$('#tk-question-card')){
      const left = document.createElement('div');
      left.id = 'tk-question-card';
      left.className = 'tk-pane';
      host.prepend(left);
    }
    if (!$('#tk-rating-card')){
      const right = document.createElement('aside');
      right.id = 'tk-rating-card';
      right.className = 'tk-pane';
      right.setAttribute('aria-label','Rating panel');
      host.appendChild(right);
    }
  }

  function renderRightPanel(){
    const card = $('#tk-rating-card');
    if (!card) return;
    card.innerHTML = `
      <div class="tk-h">Rate this</div>
      <div class="tk-scale-grid" id="tk-color-scale">
        ${[
          {n:0,t1:'No',t2:'Not for me', cls:'g0'},
          {n:1,t1:'Hard Limit',t2:'Full stop', cls:'g1'},
          {n:2,t1:'Maybe',t2:'Context matters', cls:'g2'},
          {n:3,t1:'Curious',t2:'Would try', cls:'g3'},
          {n:4,t1:'Enjoy',t2:'Like it', cls:'g4'},
          {n:5,t1:'Love',t2:'Big yes', cls:'g5'},
        ].map(x => `
          <button type="button" class="tk-chip ${x.cls}" data-val="${x.n}" aria-pressed="false">
            <span class="dot">${x.n}</span>
            <div><div class="t1">${x.t1}</div><div class="t2">${x.t2}</div></div>
          </button>
        `).join('')}
      </div>
    `;
    const grid = $('#tk-color-scale');
    grid.addEventListener('click', (e) => {
      const btn = e.target.closest('.tk-chip'); if (!btn) return;
      setRightActive(btn.dataset.val);
      setLeftActive(btn.dataset.val);
    });
  }

  function skinLeftCard(){
    const left = $('#tk-question-card');
    if (!left) return;

    // if your renderer didn't build a row, add a simple 0–5 row
    if (!left.querySelector('.tk-scale')) {
      const title = left.querySelector('.tk-question-title')?.textContent || 'Question';
      const sub   = left.querySelector('.tk-sub')?.textContent || '';
      left.innerHTML = `
        <div class="tk-question-title">${title}</div>
        ${sub ? `<div class="tk-sub">${sub}</div>` : ''}
        <div class="tk-scale" id="tk-mono-scale">
          ${[0,1,2,3,4,5].map(n=>`<button type="button" data-val="${n}">${n}</button>`).join('')}
        </div>
        <div class="tk-meta" id="tk-qmeta"></div>
      `;
    }

    const row = left.querySelector('#tk-mono-scale') || left.querySelector('.tk-scale');
    if (row && !row.dataset.wired){
      row.dataset.wired = '1';
      row.addEventListener('click', (e) => {
        const b = e.target.closest('button'); if (!b) return;
        setLeftActive(b.dataset.val);
        setRightActive(b.dataset.val);
      });
    }
  }

  function setLeftActive(val){
    const row = $('#tk-question-card .tk-scale');
    if (!row) return;
    row.querySelectorAll('button').forEach(b=>{
      b.classList.toggle('is-active', b.dataset.val === String(val));
    });
  }
  function setRightActive(val){
    const grid = $('#tk-color-scale');
    if (!grid) return;
    grid.querySelectorAll('.tk-chip').forEach(b=>{
      const on = b.dataset.val === String(val);
      b.classList.toggle('is-active', on);
      b.setAttribute('aria-pressed', on ? 'true' : 'false');
    });
  }

  // Public hook: call after YOUR app renders each question
  window.TK_DUAL_REFRESH = function(){
    ensureHostAndPanels();
    skinLeftCard();
    renderRightPanel();
  };

  // run once on load
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', window.TK_DUAL_REFRESH, { once:true });
  } else {
    window.TK_DUAL_REFRESH();
  }
})();
</script>
