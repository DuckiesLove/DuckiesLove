<!-- ================== TALK KINK — DUAL PANEL QUESTION CARD + COLORFUL SCALE ================== -->
<script>
/* ======================= JS — create right panel + sync ======================= */
(function TKDualPanel(){
  const $ = (s, r=document) => r.querySelector(s);

/* ======================= TK DUAL PANEL (question left + colorful rating right) ======================= */
(function TKDualPanel(){
  const $ = (s, r=document) => r.querySelector(s);

  // ---------- 1) inject minimal CSS (once) ----------
  const CSS = `
  /* ======================= CSS — layout + skins ======================= */

  /* Host: two-column layout (question left, colorful rating right) */
  #tk-question-host{ contain: layout style; }
  #tk-question-host.tk-dual{
    display:grid;
    grid-template-columns:minmax(520px,1fr) 360px;
    gap:24px;
    align-items:start;
  }
  @media (max-width:1100px){
    #tk-question-host.tk-dual{ grid-template-columns:1fr; }
  }

  /* Shared panel look (matches your sidebar “blue glow”) */
  .tk-pane{
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) var(--tk-surface, rgba(13,17,23,.82));
    border-radius: 18px;
    border: 1px solid var(--tk-edge, rgba(255,255,255,.10));
    box-shadow:
      inset 0 0 0 1px rgba(var(--tk-glow-rgb, 0 170 255), .15),
      0 8px 22px rgba(0,0,0,.35),
      0 0 28px var(--tk-glow-soft, rgba(0,170,255,.10));
    color: var(--fg, #eef3f9);
  }

  /* ---------------- Question card (LEFT) ---------------- */
  #tk-question-card{
    display:block !important;
    padding:18px 20px 16px;
    overflow:visible;
    max-width: 820px;
  }
  #tk-question-card *{
    white-space: normal; word-break: normal; overflow-wrap: anywhere;
  }
  #tk-question-card .tk-question-title{ font-weight:700; font-size:1.12rem; margin:6px 0 4px; }
  #tk-question-card .tk-sub{ color: var(--tk-text-subtle, rgba(255,255,255,.72)); margin-bottom:10px; }

  /* keep only the top progress (outside); never show a second inside the card */
  #tk-question-card #tk-progress, #tk-question-card .tk-progress{ display:none !important; }

  /* 0–5 mono row (left) */
  #tk-question-card .tk-scale{
    display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:nowrap; margin:8px 0 10px;
  }
  #tk-question-card .tk-scale button{
    appearance:none; background:transparent; color:#fff; padding:8px 14px; min-width:44px; border-radius:12px;
    border:1px solid rgba(var(--tk-glow-rgb, 0 170 255), .25);
    box-shadow: inset 0 0 0 1px rgba(var(--tk-glow-rgb, 0 170 255), .12), 0 0 12px rgba(var(--tk-glow-rgb, 0 170 255), .10);
    font-weight:600; transition:transform .05s, box-shadow .15s, background-color .15s;
  }
  #tk-question-card .tk-scale button:hover{ background:rgba(var(--tk-glow-rgb, 0 170 255), .08); }
  #tk-question-card .tk-scale button.is-active{
    background:rgba(var(--tk-glow-rgb, 0 170 255), .14);
    border-color:rgba(var(--tk-glow-rgb, 0 170 255), .45);
    box-shadow: inset 0 0 0 1px rgba(var(--tk-glow-rgb, 0 170 255), .35), 0 0 20px rgba(var(--tk-glow-rgb, 0 170 255), .28);
    transform:translateY(-1px);
  }
  #tk-question-card .tk-meta{ color: var(--tk-text-subtle, rgba(255,255,255,.72)); font-size:.92rem; }

  /* ---------------- Colorful rating panel (RIGHT) ---------------- */
  #tk-rating-card{ padding:16px; position:sticky; top:96px; }
  #tk-rating-card .tk-h{ font-weight:800; text-transform:uppercase; letter-spacing:.35px; font-size:.78rem; opacity:.85; margin:2px 0 8px; }
  #tk-rating-card .tk-scale-grid{ display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; }
  #tk-rating-card .tk-chip{
    display:flex; align-items:center; gap:10px; border-radius:12px; padding:10px 12px; cursor:pointer;
    border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.35);
    transition: transform .12s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
  }
  #tk-rating-card .tk-chip:hover{ transform:translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.35); }
  #tk-rating-card .dot{
    width:28px; height:28px; border-radius:999px; display:grid; place-items:center; font-weight:800; color:#071018;
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.25);
  }
  #tk-rating-card .t1{ font-weight:700; line-height:1.15; }
  #tk-rating-card .t2{ font-size:.86rem; opacity:.85; line-height:1.15; }
  /* per-score colors */
  .g0 .dot{ background:#60a5fa; }  .g0 .t1{color:#bfe0ff;}
  .g1 .dot{ background:#ef4444; }  .g1 .t1{color:#ffc6c6;}
  .g2 .dot{ background:#f59e0b; }  .g2 .t1{color:#ffe2b3;}
  .g3 .dot{ background:#10b981; }  .g3 .t1{color:#bdf5e4;}
  .g4 .dot{ background:#22c55e; }  .g4 .t1{color:#c7ffd8;}
  .g5 .dot{ background:#84cc16; }  .g5 .t1{color:#e8ffc2;}
  #tk-rating-card .tk-chip.is-active{
    outline:2px solid currentColor;
    background:rgba(255,255,255,.06);
    box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 8px 22px rgba(0,0,0,.35);
  }
  `;
  if (!document.getElementById('tk-dual-css')) {
    const style = document.createElement('style');
    style.id = 'tk-dual-css';
    style.textContent = CSS;
    document.head.appendChild(style);
  }

  // ---------- 2) ensure containers exist ----------
  function ensureHostAndPanels(){
    const host = $('#tk-question-host') || document.body;
    host.classList.add('tk-dual');

    if (!$('#tk-question-card')){
      const left = document.createElement('div');
      left.id = 'tk-question-card';
      left.className = 'tk-pane';
      host.prepend(left);
    }
    if (!$('#tk-rating-card')){
      const right = document.createElement('aside');
      right.id = 'tk-rating-card';
      right.className = 'tk-pane';
      right.setAttribute('aria-label','Rating panel');
      host.appendChild(right);
    }
  }

  // ---------- 3) render colorful rating panel ----------
  function renderRightPanel(){
    const card = $('#tk-rating-card');
    if (!card) return;
    card.innerHTML = `
      <div class="tk-h">Rate this</div>
      <div class="tk-scale-grid" id="tk-color-scale">
        ${[
          {n:0,t1:'No',t2:'Not for me', cls:'g0'},
          {n:1,t1:'Hard Limit',t2:'Full stop', cls:'g1'},
          {n:2,t1:'Maybe',t2:'Context matters', cls:'g2'},
          {n:3,t1:'Curious',t2:'Would try', cls:'g3'},
          {n:4,t1:'Enjoy',t2:'Like it', cls:'g4'},
          {n:5,t1:'Love',t2:'Big yes', cls:'g5'},
        ].map(x => `
          <button type="button" class="tk-chip ${x.cls}" data-val="${x.n}" aria-pressed="false">
            <span class="dot">${x.n}</span>
            <div><div class="t1">${x.t1}</div><div class="t2">${x.t2}</div></div>
          </button>
        `).join('')}
      </div>
    `;
    const grid = $('#tk-color-scale');
    grid.addEventListener('click', (e) => {
      const btn = e.target.closest('.tk-chip'); if (!btn) return;
      setRightActive(btn.dataset.val);
      setLeftActive(btn.dataset.val);
    });
  }

  // ---------- 4) ensure left card has a visible question & mono scale ----------
  function skinLeftCard(){
    const left = $('#tk-question-card');
    if (!left) return;

    // If your renderer didn’t build a row yet, add a simple 0–5 row
    if (!left.querySelector('.tk-scale')) {
      const title = left.querySelector('.tk-question-title')?.textContent || 'Question';
      const sub   = left.querySelector('.tk-sub')?.textContent || '';
      left.innerHTML = `
        <div class="tk-question-title">${title}</div>
        ${sub ? `<div class="tk-sub">${sub}</div>` : ''}
        <div class="tk-scale" id="tk-mono-scale">
          ${[0,1,2,3,4,5].map(n=>`<button type="button" data-val="${n}">${n}</button>`).join('')}
        </div>
        <div class="tk-meta" id="tk-qmeta"></div>
      `;
    }

    const row = left.querySelector('#tk-mono-scale') || left.querySelector('.tk-scale');
    if (row && !row.dataset.wired){
      row.dataset.wired = '1';
      row.addEventListener('click', (e) => {
        const b = e.target.closest('button'); if (!b) return;
        setLeftActive(b.dataset.val);
        setRightActive(b.dataset.val);
      });
    }
  }

  // ---------- 5) sync helpers ----------
  function setLeftActive(val){
    const row = $('#tk-question-card .tk-scale');
    if (!row) return;
    row.querySelectorAll('button').forEach(b=>{
      b.classList.toggle('is-active', b.dataset.val === String(val));
    });
  }
  function setRightActive(val){
    const grid = $('#tk-color-scale');
    if (!grid) return;
    grid.querySelectorAll('.tk-chip').forEach(b=>{
      const on = b.dataset.val === String(val);
      b.classList.toggle('is-active', on);
      b.setAttribute('aria-pressed', on ? 'true' : 'false');
    });
  }

  // ---------- 6) public hook: call after YOUR question renders ----------
  window.TK_DUAL_REFRESH = function(){
    ensureHostAndPanels();
    skinLeftCard();
    renderRightPanel();
  };

  // run once on load
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', window.TK_DUAL_REFRESH, { once:true });
  } else {
    window.TK_DUAL_REFRESH();
  }
})();

    const host = $('#tk-question-host') || document.body;
    host.classList.add('tk-dual');

    if (!$('#tk-question-card')){
      const left = document.createElement('div');
      left.id = 'tk-question-card';
      left.className = 'tk-pane';
      host.prepend(left);
    }
    if (!$('#tk-rating-card')){
      const right = document.createElement('aside');
      right.id = 'tk-rating-card';
      right.className = 'tk-pane';
      right.setAttribute('aria-label','Rating panel');
      host.appendChild(right);
    }
  }

  function renderRightPanel(){
    const card = $('#tk-rating-card');
    if (!card) return;
    card.innerHTML = `
      <div class="tk-h">Rate this</div>
      <div class="tk-scale-grid" id="tk-color-scale">
        ${[
          {n:0,t1:'No',t2:'Not for me', cls:'g0'},
          {n:1,t1:'Hard Limit',t2:'Full stop', cls:'g1'},
          {n:2,t1:'Maybe',t2:'Context matters', cls:'g2'},
          {n:3,t1:'Curious',t2:'Would try', cls:'g3'},
          {n:4,t1:'Enjoy',t2:'Like it', cls:'g4'},
          {n:5,t1:'Love',t2:'Big yes', cls:'g5'},
        ].map(x => `
          <button type="button" class="tk-chip ${x.cls}" data-val="${x.n}" aria-pressed="false">
            <span class="dot">${x.n}</span>
            <div><div class="t1">${x.t1}</div><div class="t2">${x.t2}</div></div>
          </button>
        `).join('')}
      </div>
    `;
    const grid = $('#tk-color-scale');
    grid.addEventListener('click', (e) => {
      const btn = e.target.closest('.tk-chip'); if (!btn) return;
      setRightActive(btn.dataset.val);
      setLeftActive(btn.dataset.val);
    });
  }

  function skinLeftCard(){
    const left = $('#tk-question-card');
    if (!left) return;

    // if your renderer didn't build a row, add a simple 0–5 row
    if (!left.querySelector('.tk-scale')) {
      const title = left.querySelector('.tk-question-title')?.textContent || 'Question';
      const sub   = left.querySelector('.tk-sub')?.textContent || '';
      left.innerHTML = `
        <div class="tk-question-title">${title}</div>
        ${sub ? `<div class="tk-sub">${sub}</div>` : ''}
        <div class="tk-scale" id="tk-mono-scale">
          ${[0,1,2,3,4,5].map(n=>`<button type="button" data-val="${n}">${n}</button>`).join('')}
        </div>
        <div class="tk-meta" id="tk-qmeta"></div>
      `;
    }

    const row = left.querySelector('#tk-mono-scale') || left.querySelector('.tk-scale');
    if (row && !row.dataset.wired){
      row.dataset.wired = '1';
      row.addEventListener('click', (e) => {
        const b = e.target.closest('button'); if (!b) return;
        setLeftActive(b.dataset.val);
        setRightActive(b.dataset.val);
      });
    }
  }

  function setLeftActive(val){
    const row = $('#tk-question-card .tk-scale');
    if (!row) return;
    row.querySelectorAll('button').forEach(b=>{
      b.classList.toggle('is-active', b.dataset.val === String(val));
    });
  }
  function setRightActive(val){
    const grid = $('#tk-color-scale');
    if (!grid) return;
    grid.querySelectorAll('.tk-chip').forEach(b=>{
      const on = b.dataset.val === String(val);
      b.classList.toggle('is-active', on);
      b.setAttribute('aria-pressed', on ? 'true' : 'false');
    });
  }

  // Public hook: call after YOUR app renders each question
  window.TK_DUAL_REFRESH = function(){
    ensureHostAndPanels();
    skinLeftCard();
    renderRightPanel();
  };

  // run once on load
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', window.TK_DUAL_REFRESH, { once:true });
  } else {
    window.TK_DUAL_REFRESH();
  }
})();
</script>
