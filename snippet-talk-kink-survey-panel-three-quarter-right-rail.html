<!-- TK: Panel + Right-Rail Buttons -->
<style>
  /* --- Left survey panel sizing (¾ width) --- */
  #categorySurveyPanel,
  .category-panel,
  .tk-dock-card {
    /* fallback to any of the IDs/classes we used */
  }
  :root {
    --tk-panel-width: 74vw;   /* ≈ 3/4 page */
    --tk-rail-gap: 24px;       /* spacing between panel and right rail */
    --tk-rail-maxw: 520px;     /* max width of the right rail */
  }
  #categorySurveyPanel .panel,
  .category-panel .panel,
  .tk-dock-card .panel {
    width: var(--tk-panel-width);
    max-width: var(--tk-panel-width);
  }

  /* --- Right rail container --- */
  #tkRightRail {
    position: fixed;
    top: 28px;
    right: max(16px, env(safe-area-inset-right));
    z-index: 2147483647;
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: calc(100vw - var(--tk-panel-width) - var(--tk-rail-gap) - 16px);
    max-width: var(--tk-rail-maxw);
    min-width: 260px;
    pointer-events: none; /* rail itself ignores clicks; buttons re-enable */
  }

  #tkRightRail .tk-card {
    pointer-events: auto;
    border: 2px solid #00e5ffcc;
    border-radius: 14px;
    padding: 18px 20px;
    background: rgba(0,0,0,.72);
    box-shadow: 0 10px 30px rgba(0,0,0,.45);
    backdrop-filter: blur(2px);
  }

  #tkRightRail .tk-heading {
    margin: 0 0 8px 0;
    font-weight: 700;
    font-size: 18px;
    color: #00e5ff;
  }

  #tkRightRail .tk-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid #00e5ff;
    border-radius: 12px;
    background: #000;
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    text-decoration: none;
    transition: transform .06s ease, box-shadow .12s ease, background .12s ease;
    box-shadow: 0 4px 14px rgba(0,229,255,.15);
    cursor: pointer;
  }
  #tkRightRail .tk-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,229,255,.22); }
  #tkRightRail .tk-btn:active { transform: translateY(0); }

  /* keep rail clear of the panel on very small screens */
  @media (max-width: 980px) {
    :root { --tk-panel-width: 100vw; }
    #tkRightRail { display: none; } /* hide rail on small screens */
  }
</style>

<script>
(() => {
  const log = (...a) => console.log('[TK]', ...a);

  function ensureRightRail() {
    if (document.getElementById('tkRightRail')) return;

    const rail = document.createElement('aside');
    rail.id = 'tkRightRail';
    rail.setAttribute('aria-label', 'Quick links');

    // Card 1: Individual Kink Analysis
    const card1 = document.createElement('div');
    card1.className = 'tk-card';
    card1.innerHTML = `
      <h3 class="tk-heading">Individual Kink Analysis</h3>
      <button type="button" class="tk-btn" id="tkBtnIndiv">Open Individual Kink Analysis</button>
    `;

    // Card 2: Compatibility Page
    const card2 = document.createElement('div');
    card2.className = 'tk-card';
    card2.innerHTML = `
      <h3 class="tk-heading">Compatibility Page</h3>
      <button type="button" class="tk-btn" id="tkBtnCompat">Open Compatibility Page</button>
    `;

    rail.append(card1, card2);
    document.body.appendChild(rail);

    // Wire buttons (use absolute URLs you requested)
    document.getElementById('tkBtnIndiv').onclick = () =>
      location.assign('https://talkkink.org/individualkinkanalysis.html');
    document.getElementById('tkBtnCompat').onclick = () =>
      location.assign('/compatibility.html');

    log('Right rail installed.');
  }

  function sizePanelToThreeQuarters() {
    // Try a few likely hosts for the panel
    const hosts = [
      document.getElementById('categorySurveyPanel'),
      document.querySelector('.category-panel'),
      document.querySelector('.tk-dock-card'),
    ].filter(Boolean);

    if (!hosts.length) {
      log('Panel host not found yet; will retry after load.');
      return;
    }

    // If the inner .panel exists, we size it; else size the host directly
    hosts.forEach(host => {
      const inner = host.querySelector('.panel') || host;
      inner.style.width = getComputedStyle(document.documentElement)
        .getPropertyValue('--tk-panel-width') || '74vw';
      inner.style.maxWidth = inner.style.width;
    });

    log('Panel set to ~¾ width.');
  }

  // Run after DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      sizePanelToThreeQuarters();
      ensureRightRail();
    });
  } else {
    sizePanelToThreeQuarters();
    ensureRightRail();
  }

  // Also react if your app dynamically mounts the panel later
  const mo = new MutationObserver(() => {
    sizePanelToThreeQuarters();
    ensureRightRail();
  });
  mo.observe(document.documentElement, { subtree: true, childList: true });
})();
</script>
