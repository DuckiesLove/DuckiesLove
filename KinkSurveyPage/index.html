<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Talk Kink ‚Äî Kink Survey (Preview Page)</title>

<style>
  /* ===== Theme tokens ===== */
  :root{
    --bg: #0b151a;
    --panel: #0f1f26;
    --panel-edge: rgba(0, 255, 255, 0.18);
    --text: #dff7ff;
    --muted: #9ec2cf;
    --accent: #28d;
    --accent-soft: rgba(0, 200, 255, .2);
    --glow: 0 0 24px rgba(0,255,255,.25);
    --chip-bg: #0f2931;
    --chip-ring: #1e5a68;

    --gap: 28px;
    --left: 360px;
    --right: 420px;
    --title-clear: 96px; /* sticky offset under title+themes */
    --radius: 16px;
  }
  [data-theme="lipstick"]{ --accent:#ff4d88; --accent-soft:rgba(255,77,136,.18); --chip-ring:#8c2245; }
  [data-theme="forest"]{ --accent:#34d399; --accent-soft:rgba(52,211,153,.18); --chip-ring:#1b4d3e; }
  [data-theme="blueglow"]{ --accent:#31c0ff; --accent-soft:rgba(49,192,255,.22); --chip-ring:#1b5a7a; }

  * { box-sizing: border-box; }
  html, body { height:100%; }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
  }
  .container { width:min(1400px, 100% - 40px); margin:0 auto; }

  /* Title + themes */
  header{ padding:28px 0 6px; text-align:center; }
  .title{
    font-size: clamp(36px, 5vw, 64px);
    font-weight: 900;
    letter-spacing:.5px;
    text-shadow: 0 0 0 transparent, 0 0 18px rgba(140, 255, 255, .35);
    margin:0 0 10px;
  }
  #tkThemeRow{
    display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
    margin: 0 0 16px;
  }
  .theme-chip{
    background: var(--chip-bg);
    border: 1px solid var(--chip-ring);
    color: var(--text);
    padding: 8px 14px;
    border-radius: 999px;
    cursor: pointer;
    transition: transform .08s ease, background .2s ease, border-color .2s ease;
  }
  .theme-chip:hover{ transform: translateY(-1px); }
  .theme-chip[aria-pressed="true"]{
    background: var(--accent-soft); border-color: var(--accent);
  }

  /* ===== Three-column layout ===== */
  #tkPortal{
    display:grid; gap: var(--gap);
    grid-template-columns: var(--left) 1fr var(--right);
    align-items:start;
  }

  /* Panels */
  .panel{
    background: linear-gradient(180deg, var(--panel) 0%, #0b1b22 100%);
    border:1px solid var(--panel-edge);
    border-radius: var(--radius);
    box-shadow: var(--glow);
  }
  .panel h2{ font-size: clamp(18px, 2.6vw, 28px); margin: 16px 18px 6px; }
  .panel .sub{ color: var(--muted); margin:0 18px 12px; }

  /* LEFT ‚Äî categories */
  #categoryPanel{
    position: sticky; top: var(--title-clear);
    max-height: calc(100vh - var(--title-clear));
    overflow:auto;
    padding-bottom: 6px;
  }
  #categoryPanel .head{
    padding: 14px 18px;
    border-bottom: 1px solid var(--panel-edge);
  }
  #categoryPanel .count{ color: var(--muted); font-size:14px; margin-top:4px; }
  #categoryChecklist{ list-style:none; margin:0; padding: 6px 10px 14px; display:grid; gap:8px; }
  .cat-item{
    display:flex; align-items:center; gap:10px;
    padding: 10px 10px; border-radius: 12px; cursor:pointer;
    border:1px solid transparent;
  }
  .cat-item:hover{ background: rgba(255,255,255, .02); border-color: var(--panel-edge); }
  .cat-item input{ accent-color: var(--accent); transform: scale(1.15); }

  /* CENTER ‚Äî CTAs + stream */
  #ctaStack{
    grid-column:2; display:grid; gap:14px; margin-top:2px;
    max-width: 820px; justify-self:center; width:100%;
  }
  .btn{
    background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(255,255,255,.02));
    border: 1px solid var(--accent);
    color: var(--text);
    padding: 16px 18px;
    font-weight: 700;
    letter-spacing:.2px;
    text-align:center;
    border-radius: 14px;
    box-shadow: 0 0 0 0 rgba(0,0,0,0);
    cursor:pointer;
    transition: transform .08s ease, box-shadow .15s ease, background .2s ease;
  }
  .btn:hover{
    transform: translateY(-1px);
    box-shadow: 0 8px 24px -10px rgba(0,0,0,.6), 0 0 18px var(--accent-soft);
  }

  #surveyMain{ grid-column:2; min-width:0; }
  .card{
    padding: 16px 18px 18px; margin: 12px 0 28px; border-radius: var(--radius);
    border:1px solid var(--panel-edge);
    background: linear-gradient(180deg, #0f1f26, #0a1820);
    box-shadow: var(--glow);
  }
  .card h3{ margin: 10px 0 18px; font-size: clamp(18px, 2.2vw, 26px); }
  .scale-row{ display:flex; gap:8px; flex-wrap:wrap; }
  .scale-row input{ accent-color: var(--accent); }

  /* RIGHT ‚Äî guard */
  #guardPanel{
    position:sticky; top:var(--title-clear);
    max-height: calc(100vh - var(--title-clear));
    overflow:auto; padding-bottom: 10px;
  }
  .legend{ display:grid; gap:10px; margin: 6px 12px 16px; }
  .legend .row{
    display:flex; align-items:center; gap:14px;
    background: rgba(255,255,255,.02);
    border:1px solid var(--panel-edge);
    border-radius: 14px; padding: 12px 14px;
  }
  .badge{
    display:inline-grid; place-items:center;
    width:28px; height:28px; font-weight:800; color:#001014;
    border-radius:999px;
  }
  .b0{ background:#9bdcfb; } .b1{ background:#ff6775; }
  .b2{ background:#ffd54a; } .b3{ background:#7ee1ff; }
  .b4{ background:#83f3a7; } .b5{ background:#8ad0ff; }

  /* Responsive */
  @media (max-width: 1100px){
    :root{ --left:320px; --right:380px; }
  }
  @media (max-width: 980px){
    #tkPortal{ grid-template-columns: 1fr; }
    #categoryPanel, #guardPanel{ position:static; max-height:none; overflow:visible; }
    #ctaStack{ max-width: 100%; }
  }

  /* ==== KinkSurveyPage ‚Äî ‚Äúrating card fits better‚Äù + middle column stretch ==== */
  /* Paste this at the END of your CSS (or inside a <style> block at the end of KinkSurveyPage.html). */

  /* (Optional) give the middle column a bit more real estate without breaking the
     left Categories or right Guard panels. Tweak to taste. */
  :root{
    /* If your layout already sets these, this will gently widen the middle. */
    --left: 350px;         /* was ~360px */
    --right: 400px;        /* was ~420px */
    --gap: 24px;           /* default column gap */
    --panel-edge: rgba(132, 255, 255, 0.25); /* subtle border glow color */
    --accent: #58f1ff;     /* radio accent */
  }

  /* --- Make the center ‚Äúrating card‚Äù use the whole middle column --- */
  #surveyMain .card{
    width: 100%;
    max-width: none;       /* remove any previous cap */
    margin-inline: 0;      /* no auto-centering margin */
    padding: 18px 20px 22px; /* a little breathing room */
  }

  /* --- Improved 0‚Äì5 scale row: evenly spaced, larger hit targets --- */
  /* Expect markup like:
       <div class="scale-row">
         <label><input type="radio" name="score" value="0">0</label> ... 5
       </div>
  */
  .scale-row{
    display: grid;
    grid-template-columns: repeat(6, minmax(56px, 1fr)); /* 0..5 evenly spaced */
    gap: 10px;
    align-items: center;
  }

  .scale-row label{
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 0;
    border-radius: 12px;
    border: 1px solid var(--panel-edge);
    background: rgba(255,255,255,.03);
    cursor: pointer;
    user-select: none;
    transition: background .15s ease, transform .15s ease, border-color .15s ease;
  }

  .scale-row label:hover{
    background: rgba(255,255,255,.05);
    transform: translateY(-1px);
    border-color: rgba(132, 255, 255, 0.45);
  }

  .scale-row input{
    accent-color: var(--accent);
    margin: 0;                 /* keep inputs centered within labels */
  }

  /* --- Keep things balanced on very wide displays --- */
  @media (min-width: 1400px){
    :root{ --gap: 26px; }      /* small visual balance tweak */
  }

  /* --- Safety: if any card elsewhere was globally capped, neutralize it here --- */
  .card.fit-middle{
    width: 100% !important;
    max-width: none !important;
    margin-inline: 0 !important;
    padding: 18px 20px 22px !important;
  }
  /* Add class="card fit-middle" to the rating card container only if you still
     see a width cap coming from older CSS that you can‚Äôt remove. */
</style>
</head>
<body data-theme="blueglow">
  <header class="container">
    <h1 class="title">Talk Kink Survey</h1>
    <div id="tkThemeRow" aria-label="Theme">
      <button class="theme-chip" data-theme="dark">Dark</button>
      <button class="theme-chip" data-theme="lipstick">Lipstick</button>
      <button class="theme-chip" data-theme="forest">Forest</button>
      <button class="theme-chip" data-theme="blueglow" aria-pressed="true">Blue Glow</button>
    </div>
  </header>

  <main id="tkPortal" class="container">
    <!-- LEFT: Categories -->
    <section id="categoryPanel" class="panel">
      <div class="head">
        <h2>Categories</h2>
        <div class="count"><span id="catCount">0</span> selected</div>
      </div>
      <ul id="categoryChecklist" aria-label="Kink categories"></ul>
    </section>

    <!-- CENTER: CTAs + Survey -->
    <nav id="ctaStack">
      <button id="btnStart" class="btn">Start Survey</button>
      <button id="btnIKAnalysis" class="btn">Individual Kink Analysis</button>
      <button id="btnCompat" class="btn">Compatibility Page</button>
    </nav>

    <section id="surveyMain">
      <article class="card">
        <div class="sub">Appearance Play ‚Ä¢ Choosing my partner‚Äôs outfit for the day or a scene</div>
        <h3>Giving: Rate interest/comfort (0‚Äì5)</h3>
        <div class="card panel" style="padding:12px 14px; margin-top:10px;">
          <div style="margin-bottom:10px; color:var(--muted)">Rate interest/comfort (0‚Äì5)</div>
          <div class="scale-row" role="radiogroup" aria-label="Rate 0 to 5">
            <label><input type="radio" name="rate" value="0"> 0</label>
            <label><input type="radio" name="rate" value="1"> 1</label>
            <label><input type="radio" name="rate" value="2"> 2</label>
            <label><input type="radio" name="rate" value="3"> 3</label>
            <label><input type="radio" name="rate" value="4"> 4</label>
            <label><input type="radio" name="rate" value="5"> 5</label>
          </div>
        </div>
      </article>
    </section>

    <!-- RIGHT: Question Guard / How to score -->
    <aside id="guardPanel" class="panel">
      <h2 style="margin:14px 18px 0;">Rate interest/comfort (0‚Äì5)</h2>
      <div class="sub" style="margin:6px 18px 8px;">QUESTION GUARD ¬∑ HOW TO SCORE</div>
      <div class="legend">
        <div class="row"><span class="badge b0">0</span><strong>Brain did a cartwheel</strong> ‚Äî skipped for now ü•≤</div>
        <div class="row"><span class="badge b1">1</span><strong>Hard Limit</strong> ‚Äî full stop / non-negotiable</div>
        <div class="row"><span class="badge b2">2</span><strong>Soft Limit</strong> ‚Äî willing to try; strong boundaries & safety checks</div>
        <div class="row"><span class="badge b3">3</span><strong>Curious / context-dependent</strong> ‚Äî okay with discussion; needs clear negotiation</div>
        <div class="row"><span class="badge b4">4</span><strong>Comfortable / enjoy</strong> ‚Äî generally a yes; normal precautions & check-ins</div>
        <div class="row"><span class="badge b5">5</span><strong>Favorite / enthusiastic yes</strong> ‚Äî happily into it; green light</div>
      </div>
    </aside>
  </main>

<script>
(function(){
  const el = {
    catList: document.getElementById('categoryChecklist'),
    catCount: document.getElementById('catCount'),
    btnStart: document.getElementById('btnStart'),
    surveyMain: document.getElementById('surveyMain'),
    themeRow: document.getElementById('tkThemeRow')
  };

  /* ---------- Theme handling (unchanged) ---------- */
  for (const chip of el.themeRow.querySelectorAll('.theme-chip')) {
    chip.addEventListener('click', () => {
      document.body.setAttribute('data-theme', chip.dataset.theme);
      el.themeRow.querySelectorAll('.theme-chip').forEach(c => c.removeAttribute('aria-pressed'));
      chip.setAttribute('aria-pressed','true');
    });
  }

  /* ---------- Category normalization helper ---------- */
  function catName(x){
    if (x == null) return '';
    if (typeof x === 'string') return x.trim();
    // common shapes we‚Äôve seen
    return (
      x.name ??
      x.title ??
      x.label ??
      x.display ??
      x.category ??
      x.cat ??
      ''
    ).toString().trim();
  }

  /* ---------- Category loading (updated) ---------- */
  async function loadCategories(){
    const urls = [
      '/kinksurvey/data/categories.json',
      '/kinksurvey/data/kinks.json',
      '/data/categories.json',
      '/data/kinks.json'
    ];
    for (const u of urls) {
      try{
        const res = await fetch(u, {cache:'no-store'});
        if (!res.ok) continue;
        const data = await res.json();
        
        // Case A: categories.json is an array of strings or objects
        if (Array.isArray(data)) {
          const names = data.map(catName).filter(Boolean);
          if (names.length) return names;
        }

        // Case B: { categories: [...] }
        if (data && Array.isArray(data.categories)) {
          const names = data.categories.map(catName).filter(Boolean);
          if (names.length) return names;
        }

        // Case C: kinks.json ‚Äî pull unique category fields out of kink objects
        if (data && Array.isArray(data.kinks)) {
          const set = new Set(
            data.kinks
              .map(k => catName(k.category ?? k.cat ?? k))
              .filter(Boolean)
          );
          if (set.size) return [...set];
        }
      }catch(_e){ /* try next URL */ }
    }
    return [];
  }

  /* ---------- Render (updated) ---------- */
  function renderCategories(items){
    // de-dupe + sort
    const names = [...new Set(items.map(catName).filter(Boolean))]
      .sort((a,b) => a.localeCompare(b));
    el.catList.innerHTML = '';

    names.forEach(name => {
      const li = document.createElement('li');
      li.className = 'cat-item';
      li.innerHTML = `
        <input type="checkbox" aria-label="${name}">
        <span>${name}</span>
      `;
      li.querySelector('input').addEventListener('change', updateCount);
      el.catList.appendChild(li);
    });
    updateCount();
  }

  function updateCount(){
    el.catCount.textContent = el.catList.querySelectorAll('input:checked').length;
  }

  /* ---------- Start button (unchanged demo) ---------- */
  el.btnStart.addEventListener('click', () => {
    el.surveyMain.scrollIntoView({behavior:'smooth', block:'start'});
  });

  /* ---------- Boot ---------- */
  loadCategories().then(renderCategories);
})();
</script>
</body>
</html>
