<!doctype html>
<html lang="en">
<head>
  <!-- TK rescue: clear stale caches and overlays before we load styles/scripts -->
  <script>
  (async () => {
    try {
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) {
          try {
            await r.unregister();
          } catch {}
        }
      }
      if (window.caches) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
      }
    } catch {}
    try {
      const style = document.createElement('style');
      style.textContent = `#overlay, .overlay, [data-overlay], .tk-overlay { display:none !important; }
         body { opacity:1 !important; }`;
      document.head.appendChild(style);
    } catch {}
    try {
      const u = new URL(location.href);
      if (!u.searchParams.has('nuke')) {
        u.searchParams.set('nuke', Date.now());
        location.replace(u);
      }
    } catch {}
  })();
  </script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Talk Kink Survey â€” Prototype</title>
<style>
  /* --- global box model so borders/padding don't cause overflow --- */
  *,*::before,*::after{ box-sizing:border-box }

  :root{
    --bg: #081017;
    --panel: #0f1f28;
    --ink: #e7f7ff;
    --ink-dim: #a5c7d2;
    --edge: rgba(132,255,255,.25);
    --glow: 0 0 0.75rem rgba(88, 241, 255, .25);
    --accent: #58f1ff;

    --left: 360px;    /* left column */
    --right: 420px;   /* right column */
    --gap: 24px;      /* column gap */
    --radius: 16px;
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font:16px/1.4 system-ui, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }

  .container{max-width:1300px; margin:0 auto; padding:24px 18px 64px}

  h1#title{
    margin: 0 0 12px;                 /* tighter so the right panel appears above the fold */
    text-align:center;
    font-size: clamp(28px, 6vw, 64px);
    font-weight: 800;
    letter-spacing:.5px;
    text-shadow: 0 0 18px rgba(88,241,255,.38);
  }

  .theme-row{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin: 0 0 10px;
  }
  .chip{
    background:rgba(255,255,255,.03); border:1px solid var(--edge);
    padding:7px 12px; border-radius:999px; color:var(--ink); cursor:pointer;
    transition:transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .chip:hover{ transform:translateY(-1px); background:rgba(255,255,255,.05); border-color:rgba(132,255,255,.45) }
  .chip.active{ box-shadow: var(--glow); background:rgba(88,241,255,.1); border-color:rgba(132,255,255,.55) }

  /* CTAs */
  .cta-grid{
    display:grid;
    grid-template-columns: var(--left) 1fr var(--right);
    gap: var(--gap);
    margin-bottom: 10px;              /* tighten */
  }
  #ctaStack{ grid-column: 2 / span 1; display:grid; gap:10px }
  .btn{
    border:1px solid var(--edge); background:rgba(255,255,255,.03); color:var(--ink);
    padding:14px 18px; border-radius:999px; text-align:center; font-weight:700;
    box-shadow: var(--glow); cursor:pointer; transition:transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(132,255,255,.45); }

  /* 3 columns */
  .tk-columns{ display:grid; grid-template-columns: var(--left) 1fr var(--right); gap: var(--gap); align-items:start }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.03));
    border:1px solid var(--edge); border-radius:var(--radius); box-shadow: var(--glow);
  }
  .card > .card-hd{
    padding:14px 16px; border-bottom:1px solid rgba(132,255,255,.12); color:var(--ink);
    font-size: clamp(18px, 2.6vw, 24px); font-weight:800; letter-spacing:.3px;
  }
  .card > .card-bd{ padding:14px 16px 16px }

  /* left categories */
  .tk-left{ max-height: calc(100vh - 170px); overflow:auto }  /* a bit taller, still fits viewport */
  .cat-list{ list-style:none; margin:0; padding:0 }
  .cat-item{
    display:flex; align-items:center; gap:12px; padding:12px 14px; margin:8px 12px;
    border-radius:12px; background:rgba(255,255,255,.02); border:1px solid rgba(132,255,255,.14); color:var(--ink);
  }
  .cat-item input{ accent-color: var(--accent) }

  /* middle card */
  #surveyMain.card{ width:100%; max-width:none; margin-inline:0 }
  #surveyMain .lead{ color: var(--ink-dim) }

  /* --- FIT-BETTER rating box --- */
  .rating-wrap{
    background: rgba(255,255,255,.03);
    border: 1px solid var(--edge);
    border-radius: 14px;
    padding:12px;
    margin-top: 8px;
  }
  .scale-title{ font-weight:700; color:var(--ink-dim); margin-bottom:8px }

  /* Key change: flex + equal-width pills that shrink as needed. No overflow. */
  .scale-row{
    display:flex; gap:10px; align-items:stretch; width:100%;
    min-width: 0;            /* allow shrink inside grid cell */
  }
  .pill{
    flex: 1 1 0;             /* equal columns; can shrink */
    min-width: 0;            /* let text/radio wrap within */
    display:flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 6px; border-radius:12px;
    border:1px solid var(--edge); background:rgba(255,255,255,.03);
    cursor:pointer; user-select:none;
    transition: background .15s ease, transform .15s ease, border-color .15s ease;
  }
  .pill:hover{ background: rgba(255,255,255,.06); border-color: rgba(132,255,255,.45); transform: translateY(-1px);}
  .pill input{ width:16px; height:16px; margin:0; accent-color: var(--accent); }

  /* right guard: raise header so first guard card is visible without scrolling on laptops */
  .tk-right{ max-height: calc(100vh - 170px); overflow:auto } /* internal scroll only when needed */
  .tk-right .card-hd{ position:sticky; top:0; background:linear-gradient(180deg, rgba(8,16,23,.9), rgba(8,16,23,.7)); backdrop-filter: blur(2px); z-index:2 }

  .guard-list{ display:flex; flex-direction:column; gap:10px; padding:10px }
  .guard-item{
    display:flex; gap:14px; align-items:flex-start;
    padding:12px; border-radius:14px; background:rgba(255,255,255,.03); border:1px solid var(--edge);
  }
  .badge{
    width:34px; height:34px; min-width:34px; display:grid; place-items:center;
    border-radius:999px; font-weight:800; color:#04141b; background:#58f1ff;
  }
  .badge.bad-1{ background:#ff6b6b}
  .badge.bad-2{ background:#ffd166}
  .badge.bad-3{ background:#6fd3ff}
  .badge.bad-4{ background:#72ffb3}

  @media (max-width: 1160px){ :root{ --right: 360px; --left: 320px } }
  @media (max-width: 980px){
    .cta-grid{ display:block }
    .tk-columns{ grid-template-columns: 1fr }
    .tk-left,.tk-right{ max-height:none; overflow:visible }
  }
</style>
</head>
<body>
  <div class="container">
    <h1 id="title">Talk Kink Survey</h1>

    <div class="theme-row" id="themeRow">
      <button class="chip active" data-theme="dark">Dark</button>
      <button class="chip" data-theme="lipstick">Lipstick</button>
      <button class="chip" data-theme="forest">Forest</button>
      <button class="chip" data-theme="glow">Blue Glow</button>
    </div>

    <div class="cta-grid">
      <div></div>
      <nav id="ctaStack">
        <a class="btn" href="#surveyMain">Start Survey</a>
        <a class="btn" href="/kinksurvey/#analysis">Individual Kink Analysis</a>
        <a class="btn" href="/kinksurvey/#compatibility">Compatibility Page</a>
      </nav>
      <div></div>
    </div>

    <section class="tk-columns">
      <!-- LEFT -->
      <aside class="card tk-left" id="catCard">
        <div class="card-hd">Categories</div>
        <div class="card-bd">
          <ul id="catList" class="cat-list" aria-label="Kink categories"></ul>
        </div>
      </aside>

      <!-- MIDDLE -->
      <main class="card" id="surveyMain" aria-live="polite">
        <div class="card-hd">
          <div class="lead">Appearance Play â€¢ Choosing my partnerâ€™s outfit for the day or a scene</div>
          <div style="margin-top:6px; font-size: clamp(20px, 3.2vw, 30px); font-weight:800;">
            Giving: Rate interest/comfort (0â€“5)
          </div>
        </div>
        <div class="card-bd">
          <div class="rating-wrap" role="group" aria-labelledby="scaleTitle">
            <div id="scaleTitle" class="scale-title">Rate interest/comfort (0â€“5)</div>
            <div class="scale-row" id="scaleRow"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside class="card tk-right">
        <div class="card-hd">Rate interest/comfort (0â€“5)</div>
        <div class="guard-list card-bd">
          <div class="guard-item">
            <div class="badge">0</div>
            <div><strong>Brain did a cartwheel</strong> â€” skipped for now ðŸ¥²</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-1">1</div>
            <div><strong>Hard Limit</strong> â€” full stop / non-negotiable</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-2">2</div>
            <div><strong>Soft Limit</strong> â€” willing to try; strong boundaries &amp; safety checks</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-3">3</div>
            <div><strong>Curious / context-dependent</strong> â€” okay with discussion; needs clear negotiation</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-4">4</div>
            <div><strong>Comfortable / enjoy</strong> â€” generally a yes; normal precautions &amp; check-ins</div>
          </div>
          <div class="guard-item">
            <div class="badge">5</div>
            <div><strong>Favorite / enthusiastic yes</strong> â€” happily into it; green-light</div>
          </div>
        </div>
      </aside>
    </section>
  </div>

<script>
/* themes (cosmetic) */
document.querySelectorAll('.chip').forEach(chip=>{
  chip.addEventListener('click', ()=>{
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    chip.classList.add('active');
  });
});

/* categories */
const catTargets = [
  '/data/categories.json',
  '/kinksurvey/data/categories.json',
  '/KinkSurveyPage/data/categories.json'
];
async function loadCategories(){
  let data = null;
  for(const path of catTargets){
    try{ const r = await fetch(path,{cache:'no-store'}); if(r.ok){ data = await r.json(); break; } }catch(e){}
  }
  if(!data){
    data = ["Appearance Play","Behavioral Play","Body Fluids and Functions","Body Modification",
            "Body Part / Fetish Play","Body Part Torture","Bondage and Suspension","Breath Play",
            "Breeding","Chastity Devices","Communication","Consent & Safewords"];
  }
  const normalize = v => typeof v === 'string' ? v : (v?.name ?? String(v));
  const ul = document.getElementById('catList');
  ul.innerHTML = '';
  (Array.isArray(data)?data.map(normalize):[]).forEach(name=>{
    const li = document.createElement('li');
    li.className = 'cat-item';
    li.innerHTML = `<input type="checkbox" aria-label="${name}"><span>${name}</span>`;
    ul.appendChild(li);
  });
}
loadCategories();

/* 0â€“5 pills: equal width, never overflow */
const scaleRow = document.getElementById('scaleRow');
for(let v=0; v<=5; v++){
  const lab = document.createElement('label');
  lab.className = 'pill';
  lab.innerHTML = `<input type="radio" name="score" value="${v}"><span>${v}</span>`;
  scaleRow.appendChild(lab);
}
scaleRow.querySelector('input[value="0"]').checked = true;
</script>
</body>
</html>
