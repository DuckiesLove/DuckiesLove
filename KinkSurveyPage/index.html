<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Talk Kink Survey ‚Äî Prototype</title>
<style>
  /* --- global box model so borders/padding don't cause overflow --- */
  *,*::before,*::after{ box-sizing:border-box }

  :root{
    --bg: #081017;
    --panel: #0f1f28;
    --ink: #e7f7ff;
    --ink-dim: #a5c7d2;
    --edge: rgba(132,255,255,.25);
    --glow: 0 0 0.75rem rgba(88, 241, 255, .25);
    --accent: #58f1ff;

    --left: 360px;    /* left column */
    --right: 420px;   /* right column */
    --gap: 24px;      /* column gap */
    --radius: 16px;
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font:16px/1.4 system-ui, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }

  .container{max-width:1300px; margin:0 auto; padding:24px 18px 64px}

  h1#title{
    margin: 0 0 12px;                 /* tighter so the right panel appears above the fold */
    text-align:center;
    font-size: clamp(28px, 6vw, 64px);
    font-weight: 800;
    letter-spacing:.5px;
    text-shadow: 0 0 18px rgba(88,241,255,.38);
  }

  .theme-row{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin: 0 0 10px;
  }
  .chip{
    background:rgba(255,255,255,.03); border:1px solid var(--edge);
    padding:7px 12px; border-radius:999px; color:var(--ink); cursor:pointer;
    transition:transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .chip:hover{ transform:translateY(-1px); background:rgba(255,255,255,.05); border-color:rgba(132,255,255,.45) }
  .chip.active{ box-shadow: var(--glow); background:rgba(88,241,255,.1); border-color:rgba(132,255,255,.55) }

  /* CTAs */
  .cta-grid{
    display:grid;
    grid-template-columns: var(--left) 1fr var(--right);
    gap: var(--gap);
    margin-bottom: 10px;              /* tighten */
  }
  #ctaStack{ display:grid; gap:10px }
  .btn{
    border:1px solid var(--edge); background:rgba(255,255,255,.03); color:var(--ink);
    padding:14px 18px; border-radius:999px; text-align:center; font-weight:700;
    box-shadow: var(--glow); cursor:pointer; transition:transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(132,255,255,.45); }

  /* 3 columns */
  .tk-columns{ display:grid; grid-template-columns: var(--left) 1fr var(--right); gap: var(--gap); align-items:start }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.03));
    border:1px solid var(--edge); border-radius:var(--radius); box-shadow: var(--glow);
  }
  .card > .card-hd{
    padding:14px 16px; border-bottom:1px solid rgba(132,255,255,.12); color:var(--ink);
    font-size: clamp(18px, 2.6vw, 24px); font-weight:800; letter-spacing:.3px;
  }
  .card > .card-bd{ padding:14px 16px 16px }

  /* left categories */
  .tk-left{ max-height: calc(100vh - 90px); overflow:auto }  /* taller viewport allowance */
  .cat-list{ list-style:none; margin:0; padding:0 }
  .cat-item{
    display:flex; align-items:center; gap:12px; padding:12px 14px; margin:8px 12px;
    border-radius:12px; background:rgba(255,255,255,.02); border:1px solid rgba(132,255,255,.14); color:var(--ink);
  }
  .cat-item input{ accent-color: var(--accent) }

  /* middle card */
  #questionColumn.card{ width:100%; max-width:none; margin-inline:0 }
  #questionColumn .lead{
    color: var(--ink-dim);
    font-size: clamp(14px, 2vw, 18px);
    line-height: 1.35;
  }

  #questionColumn .subhead{
    margin-top: 6px;
    font-size: clamp(14px, 2vw, 18px);
    font-weight: 800;
    color: var(--ink);
  }

  /* --- FIT-BETTER rating box --- */
  .rating-wrap{
    background: rgba(255,255,255,.03);
    border: 1px solid var(--edge);
    border-radius: 14px;
    padding:12px;
    margin-top: 8px;
  }
  .scale-title{ font-weight:700; color:var(--ink-dim); margin-bottom:8px }

  /* Key change: flex + equal-width pills that shrink as needed. No overflow. */
  .scale-row{
    display:flex; gap:10px; align-items:stretch; width:100%;
    min-width: 0;            /* allow shrink inside grid cell */
  }
  .pill{
    flex: 1 1 0;             /* equal columns; can shrink */
    min-width: 0;            /* let text/radio wrap within */
    display:flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 6px; border-radius:12px;
    border:1px solid var(--edge); background:rgba(255,255,255,.03);
    cursor:pointer; user-select:none;
    transition: background .15s ease, transform .15s ease, border-color .15s ease;
  }
  .pill:hover{ background: rgba(255,255,255,.06); border-color: rgba(132,255,255,.45); transform: translateY(-1px);}
  .pill input{ width:16px; height:16px; margin:0; accent-color: var(--accent); }

  /* right guard: raise header so first guard card is visible without scrolling on laptops */
  .tk-right{ max-height: calc(100vh - 170px); overflow:auto } /* internal scroll only when needed */
  .tk-right .card-hd{ position:sticky; top:0; background:linear-gradient(180deg, rgba(8,16,23,.9), rgba(8,16,23,.7)); backdrop-filter: blur(2px); z-index:2 }

  .guard-list{ display:flex; flex-direction:column; gap:10px; padding:10px }
  .guard-item{
    display:flex; gap:14px; align-items:flex-start;
    padding:12px; border-radius:14px; background:rgba(255,255,255,.03); border:1px solid var(--edge);
  }
  .badge{
    width:34px; height:34px; min-width:34px; display:grid; place-items:center;
    border-radius:999px; font-weight:800; color:#04141b; background:#58f1ff;
  }
  .badge.bad-1{ background:#ff6b6b}
  .badge.bad-2{ background:#ffd166}
  .badge.bad-3{ background:#6fd3ff}
  .badge.bad-4{ background:#72ffb3}

  @media (max-width: 1160px){ :root{ --right: 360px; --left: 320px } }
  @media (max-width: 980px){
    .cta-grid{ display:block }
    .tk-columns{ grid-template-columns: 1fr }
    .tk-left,.tk-right{ max-height:none; overflow:visible }
  }
</style>
<style id="kinksurvey-layout-tuneups">
  :root{
    /* keep your existing custom properties; nothing to change here */
  }

  /* 1) More breathing room below the stacked CTAs */
  .cta-grid{
    margin-bottom: 22px;          /* was ~10px in the previous build */
  }

  /* 2) Left column scrolls ‚Äúlonger‚Äù (more items visible before it needs to scroll) */
  .tk-left{
    /* was: max-height: calc(100vh - 170px); */
    max-height: calc(100vh - 90px);    /* show more categories before scrolling */
    overflow: auto;                     /* keep internal scroll on the left only */
  }

  /* 3) Nudge the whole three-column grid down a bit more from the CTAs (optional, subtle) */
  .tk-columns{
    margin-top: 10px;              /* extra space between buttons and middle card */
  }

  /* 4) Right column shows the WHOLE scale with no internal scrollbar on desktop */
  @media (min-width: 981px){
    .tk-right{
      max-height: none;            /* let the page scroll instead of the panel */
      overflow: visible;           /* no inner scrollbar */
    }
    .tk-right .card-hd{
      position: static;            /* unstick the header so content starts higher */
    }
  }

  /* (Keep the mobile behavior: single-column stack with natural page scroll) */
  @media (max-width: 980px){
    .tk-left{ max-height: none; overflow: visible; }
    .tk-right{ max-height: none; overflow: visible; }
  }

  /* 5) Ensure the 0‚Äì5 pills always fit within the middle card and never wrap weirdly */
  .rating-wrap{ padding: 12px; }
  .scale-row{
    display: flex; gap: 10px; width: 100%;
    min-width: 0;                  /* allows shrinking inside grid cell */
  }
  .pill{
    flex: 1 1 0;                   /* equal width, shrinkable */
    min-width: 0;
    padding: 12px 6px;
  }
</style>
<style>
  /* Utility: completely hide until we want to reveal via JS */
  .is-hidden { display: none !important; }

  /* Stacked CTA look ‚Äî same style you had ‚Äúbefore‚Äù */
  #ctaStack.tk-stack{
    display: grid;
    gap: 16px;
    margin-inline: auto;
    max-width: 720px;
  }
  #ctaStack .btn{
    display: block;
    width: 100%;
    padding: 18px 22px;
    border: 2px solid var(--tk-accent, #1ee0ff);
    border-radius: 16px;
    background: rgba(0,0,0,.25);
    color: #eafcff;
    font-weight: 700;
    text-align: center;
    text-decoration: none;
    box-shadow: 0 0 24px rgba(30,224,255,.15) inset, 0 0 18px rgba(30,224,255,.12);
    transition: transform .08s ease, box-shadow .18s ease, background .18s ease;
  }
  #ctaStack .btn:hover{ transform: translateY(-1px); box-shadow: 0 0 28px rgba(30,224,255,.25) inset, 0 0 22px rgba(30,224,255,.16); }
  #ctaStack .btn:active{ transform: translateY(0); }

  /* Disabled Start state until a category is selected */
  #btnStart[disabled]{
    opacity: .45; cursor: not-allowed;
    filter: grayscale(.3);
  }

  /* Layout wrappers (use your existing classes as well) */
  .tk-columns{
    display: grid;
    grid-template-columns: 380px 1fr 420px;   /* left / middle / right */
    gap: 28px;
    align-items: start;
    margin-top: 18px;                         /* space below CTAs */
  }

  /* Left column: allow internal scroll (longer list) */
  #catColumn{
    max-height: calc(100vh - 100px);
    overflow: auto;
  }

  /* Middle and right columns start hidden (JS will unhide) */
  #questionColumn.is-hidden,
  #scaleColumn.is-hidden { display: none !important; }

  /* Keep mobile friendly */
  @media (max-width: 980px){
    .tk-columns{ grid-template-columns: 1fr; }
    #catColumn{ max-height: none; overflow: visible; }
    /* We‚Äôll still hide question/scale at start on mobile, then reveal to stack below */
  }
</style>
<style>
  /* Tuck the hero/title + theme row tighter */
  h1.tk-title{ margin-bottom: 8px !important; line-height: 1.05; }
  #themeRow{ display:flex; gap:.6rem; justify-content:center; margin: 6px 0 10px; }

  /* Make the stacked buttons wider and bring them up under the title */
  #ctaStack.tk-stack{
    /* Wider like your earlier design */
    max-width: clamp(680px, 68vw, 1040px);
    margin-inline: auto;
    margin-top: 8px;              /* closer to the title */
    gap: 18px;                    /* spacing between the three buttons */
  }
  /* Button look & size (closer to your ‚Äúbefore‚Äù) */
  #ctaStack .btn{
    display:block;
    width: 100%;
    padding: 22px 26px;
    border-radius: 20px;
    font-size: 22px;              /* larger label */
    font-weight: 800;
    letter-spacing: .2px;
    border: 2px solid var(--tk-accent, #1ee0ff);
    background: rgba(0,0,0,.28);
    color: #eafcff;
    text-align:center;
    box-shadow: 0 0 28px rgba(30,224,255,.18) inset, 0 0 22px rgba(30,224,255,.14);
    transition: transform .08s ease, box-shadow .18s ease, background .18s ease;
  }
  #ctaStack .btn:hover{
    transform: translateY(-1px);
    box-shadow: 0 0 34px rgba(30,224,255,.26) inset, 0 0 26px rgba(30,224,255,.18);
  }

  /* Start the three-column grid a touch lower so buttons feel attached to title */
  .tk-columns{ margin-top: 16px; }

  /* Keep left panel tall/scrollable as you had */
  #catColumn{
    max-height: calc(100vh - 100px);
    overflow: auto;
  }

  /* Safety: if any global section has a big top margin, neutralize it under the CTAs */
  #ctaStack + * { margin-top: 16px !important; }

  /* Mobile: keep buttons readable and centered */
  @media (max-width: 980px){
    #ctaStack.tk-stack{ max-width: min(96vw, 720px); }
    #ctaStack .btn{ font-size: 20px; padding: 18px 22px; }
  }
</style>
<style>
  /* Treat the title + theme chips + CTA stack as one centered hero block */
  .tk-hero,
  body > header,
  #titleArea {
    display: grid;
    justify-items: center;
  }

  /* Center the theme selector row */
  #themeRow{
    display:flex;
    gap:.6rem;
    justify-content:center;
    margin: 8px 0 0;
  }

  /* Center the stacked buttons with the theme row and push them down a bit */
  #ctaStack.tk-stack{
    display: grid;
    justify-items: center;
    width: min(92vw, 980px);
    margin-top: 36px;
    gap: 18px;
  }

  /* (Optional) keep button labels readable and consistent */
  #ctaStack .btn{
    width: 100%;
    padding: 22px 26px;
    border-radius: 20px;
    font-size: 22px;
    font-weight: 800;
    text-align: center;
  }

  /* Make sure the grid below doesn‚Äôt collide with the hero */
  .tk-columns{ margin-top: 18px; }

  @media (max-width: 980px){
    #ctaStack.tk-stack{ width: min(96vw, 760px); margin-top: 28px; }
    #ctaStack .btn{ font-size: 20px; padding: 18px 22px; }
  }
</style>
<style>
/* Drop this at the very end of KinkSurveyPage/index.html (after your theme css)
   Goal: center CTAs under the theme chips AND keep them a reasonable width. */

  /* Treat title + theme chips + CTAs as one centered ‚Äúhero‚Äù block */
  .tk-hero{
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap: 16px;
    width:min(92vw, 720px);
    margin: 0 auto 32px;
  }

  .tk-hero #title{
    margin-bottom: 0;
  }

  /* Theme chips row (already centered visually) */
  #themeRow{
    display:flex;
    gap:.6rem;
    justify-content:center;
    width:100%;
    margin: 0 auto;
  }

  /* CTA stack: same width as theme row, centered, not huge */
  #ctaStack.tk-stack{
    display:grid;
    width:100%;
    margin: 0;
    gap:16px;
  }

  /* Buttons fill the stack width but don‚Äôt sprawl */
  #ctaStack .btn{
    width:100%;
    padding:18px 22px;
    border-radius:18px;
    font-size:22px;
    font-weight:800;
    text-align:center;
  }

  /* Tweak sizes slightly on small screens */
  @media (max-width: 760px){
    .tk-hero{ width:min(94vw, 560px); }
    #themeRow, #ctaStack.tk-stack{ width:100%; }
    #ctaStack .btn{ font-size:20px; padding:16px 20px; }
  }
</style>
</head>
<body>
  <div class="container">
    <header class="tk-hero">
      <h1 id="title" class="tk-title">Talk Kink Survey</h1>

      <div class="theme-row" id="themeRow">
        <button class="chip active" data-theme="dark">Dark</button>
        <button class="chip" data-theme="lipstick">Lipstick</button>
        <button class="chip" data-theme="forest">Forest</button>
        <button class="chip" data-theme="glow">Blue Glow</button>
      </div>

      <nav id="ctaStack" class="tk-stack">
        <button id="btnStart" class="btn" type="button" disabled>Start Survey</button>
        <a class="btn" href="/kinksurvey/#analysis">Individual Kink Analysis</a>
        <a class="btn" href="/kinksurvey/#compatibility">Compatibility Page</a>
      </nav>
    </header>

    <section class="tk-columns">
      <!-- LEFT -->
      <aside class="card tk-left" id="catColumn">
        <div class="card-hd">Categories</div>
        <div class="card-bd">
          <ul id="catList" class="cat-list" aria-label="Kink categories"></ul>
        </div>
      </aside>

      <!-- MIDDLE -->
      <main class="card is-hidden" id="questionColumn" aria-live="polite">
        <div class="card-hd">
          <div class="lead">Appearance Play ‚Ä¢ Choosing my partner‚Äôs outfit for the day or a scene</div>
          <div class="subhead">Giving: Rate interest/comfort (0‚Äì5)</div>
        </div>
        <div class="card-bd">
          <div class="rating-wrap" role="group" aria-labelledby="scaleTitle">
            <div id="scaleTitle" class="scale-title">Rate interest/comfort (0‚Äì5)</div>
            <div class="scale-row" id="scaleRow"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside class="card tk-right is-hidden" id="scaleColumn">
        <div class="card-hd">Rate interest/comfort (0‚Äì5)</div>
        <div class="guard-list card-bd">
          <div class="guard-item">
            <div class="badge">0</div>
            <div><strong>Brain did a cartwheel</strong> ‚Äî skipped for now ü•≤</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-1">1</div>
            <div><strong>Hard Limit</strong> ‚Äî full stop / non-negotiable</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-2">2</div>
            <div><strong>Soft Limit</strong> ‚Äî willing to try; strong boundaries &amp; safety checks</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-3">3</div>
            <div><strong>Curious / context-dependent</strong> ‚Äî okay with discussion; needs clear negotiation</div>
          </div>
          <div class="guard-item">
            <div class="badge bad-4">4</div>
            <div><strong>Comfortable / enjoy</strong> ‚Äî generally a yes; normal precautions &amp; check-ins</div>
          </div>
          <div class="guard-item">
            <div class="badge">5</div>
            <div><strong>Favorite / enthusiastic yes</strong> ‚Äî happily into it; green-light</div>
          </div>
        </div>
      </aside>
    </section>
  </div>

<script>
(() => {
  // CONFIG ‚Äî if your category checkboxes use a different selector, update here:
  const CAT_CHECK_SELECTOR = '#catColumn input[type="checkbox"], #catColumn .cat-check';

  const $start   = document.getElementById('btnStart');
  const $cats    = document.getElementById('catColumn');
  const $middle  = document.getElementById('questionColumn');
  const $right   = document.getElementById('scaleColumn');
  const $cta     = document.getElementById('ctaStack');

  if (!$start || !$cats || !$middle || !$right) {
    console.warn('[KinkSurveyPage] Required elements not found. Check IDs: btnStart, catColumn, questionColumn, scaleColumn');
    return;
  }

  // Helper: count selected categories
  const selectedCount = () => {
    return Array.from(document.querySelectorAll(CAT_CHECK_SELECTOR))
      .filter(el => el.checked).length;
  };

  // Set initial state: only CTAs + categories visible
  const syncStartEnabled = () => {
    const n = selectedCount();
    $start.disabled = n === 0;
  };

  // Wire up category changes to enable/disable Start
  const observeCategoryChanges = () => {
    const inputs = document.querySelectorAll(CAT_CHECK_SELECTOR);
    inputs.forEach(el => el.addEventListener('change', syncStartEnabled));
    // Fallback for dynamically injected checkboxes
    if ($cats) {
      $cats.addEventListener('change', syncStartEnabled);
    }
  };

  // Reveal middle & right when Start is clicked (and at least one category is selected)
  const onStart = () => {
    if ($start.disabled) {
      // optional: a little nudge for the user
      $start.classList.add('tk-wiggle');
      setTimeout(() => $start.classList.remove('tk-wiggle'), 350);
      return;
    }
    // Show columns
    $middle.classList.remove('is-hidden');
    $right.classList.remove('is-hidden');

    // Optional: scroll the grid into view, just below the buttons
    const topY = $cta.getBoundingClientRect().bottom + window.scrollY - 8;
    window.scrollTo({ top: topY, behavior: 'smooth' });
  };

  // Little CSS wiggle (optional)
  const wiggleStyle = document.createElement('style');
  wiggleStyle.textContent = `
    .tk-wiggle{ animation: tkW .35s ease; }
    @keyframes tkW{ 0%,100%{ transform: translateX(0);} 25%{ transform: translateX(-2px);} 75%{ transform: translateX(2px);} }
  `;
  document.head.appendChild(wiggleStyle);

  // Init
  observeCategoryChanges();
  syncStartEnabled();
  $start.addEventListener('click', onStart);
})();
</script>
<script>
/* themes (cosmetic) */
document.querySelectorAll('.chip').forEach(chip=>{
  chip.addEventListener('click', ()=>{
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    chip.classList.add('active');
  });
});

/* categories */
const catTargets = [
  '/data/categories.json',
  '/kinksurvey/data/categories.json',
  '/KinkSurveyPage/data/categories.json'
];
async function loadCategories(){
  let data = null;
  for(const path of catTargets){
    try{ const r = await fetch(path,{cache:'no-store'}); if(r.ok){ data = await r.json(); break; } }catch(e){}
  }
  if(!data){
    data = ["Appearance Play","Behavioral Play","Body Fluids and Functions","Body Modification",
            "Body Part / Fetish Play","Body Part Torture","Bondage and Suspension","Breath Play",
            "Breeding","Chastity Devices","Communication","Consent & Safewords"];
  }
  const normalize = v => typeof v === 'string' ? v : (v?.name ?? String(v));
  const ul = document.getElementById('catList');
  ul.innerHTML = '';
  (Array.isArray(data)?data.map(normalize):[]).forEach(name=>{
    const li = document.createElement('li');
    li.className = 'cat-item';
    li.innerHTML = `<input type="checkbox" aria-label="${name}"><span>${name}</span>`;
    ul.appendChild(li);
  });
}
loadCategories();

/* 0‚Äì5 pills: equal width, never overflow */
const scaleRow = document.getElementById('scaleRow');
for(let v=0; v<=5; v++){
  const lab = document.createElement('label');
  lab.className = 'pill';
  lab.innerHTML = `<input type="radio" name="score" value="${v}"><span>${v}</span>`;
  scaleRow.appendChild(lab);
}
scaleRow.querySelector('input[value="0"]').checked = true;
</script>
<style>
  /* Keep the title, chips, and CTAs in one centered hero */
  #titleArea, .tk-hero{
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap:16px;
  }

  /* Chips row spans the hero width */
  #themeRow{
    display:flex;
    gap:.6rem;
    align-items:center;
    justify-content:center;
    width:100%;
    margin:8px auto 0;
  }

  /* CTA stack mirrors the theme row width */
  #ctaStack.tk-stack{
    display:grid;
    justify-items:stretch;
    margin:0;
    gap:16px;
    width:100%;
    max-width:95vw;
  }

  /* Buttons fill the stack width */
  #ctaStack .btn{
    width:100%;
    padding:14px 18px;
    border-radius:16px;
    font-size:18px;
    font-weight:700;
    text-align:center;
    box-sizing:border-box;
  }

  @media (max-width: 640px){
    #ctaStack .btn{ font-size:16px; padding:12px 16px; }
  }
</style>

<script>
  // Make CTA buttons exactly as wide as the theme chips row.
  (function () {
    const chips = document.getElementById('themeRow');
    const ctas  = document.getElementById('ctaStack');
    if (!chips || !ctas) return;

    function sizeCTAs() {
      // include sub-pixel and a tiny breathing room so borders don‚Äôt wrap
      const w = Math.ceil(chips.getBoundingClientRect().width) + 2;
      ctas.style.width = Math.min(w, document.documentElement.clientWidth * 0.95) + 'px';
    }

    // run on load and any resize/theme/font change
    window.addEventListener('load', sizeCTAs, { once:true });
    window.addEventListener('resize', sizeCTAs);
    // if your theme chips can hide/show, observe layout changes too
    const ro = new ResizeObserver(sizeCTAs);
    ro.observe(chips);
  })();
</script>
</body>
</html>
