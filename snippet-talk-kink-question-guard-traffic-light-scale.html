<!-- TalkKink — Question Glow + Question Guard + Traffic-Light Scale -->
<script>
/* ===========================================================
   TalkKink — Question Glow + Question Guard + Traffic-Light Scale
   Drop this once into your site JS (Codex). No DevTools required.
   =========================================================== */
(function () {
  // ---------- 1) CSS (once) ----------
  if (!document.getElementById('tkGuardCSS')) {
    const style = document.createElement('style');
    style.id = 'tkGuardCSS';
    style.textContent = /*css*/`
      /* Glow around the EXISTING question card */
      .tk-question-card {
        position: relative;
        border-radius: 14px;
        background: rgba(10, 12, 16, 0.75);
        border: 1px solid rgba(120, 200, 255, 0.18);
        box-shadow:
          0 0 0 1px rgba(120, 200, 255, 0.18) inset,
          0 10px 28px rgba(0, 0, 0, 0.45),
          0 0 18px rgba(50, 170, 255, 0.35);
      }

      /* “Question Guard” info box */
      .tk-guard {
        margin: 10px 0 14px;
        padding: 12px 14px;
        border-radius: 12px;
        background: rgba(12, 16, 22, 0.9);
        border: 1px solid rgba(120, 200, 255, 0.28);
        box-shadow:
          0 0 0 1px rgba(120, 200, 255, 0.18) inset,
          0 0 16px rgba(50, 170, 255, 0.25);
      }
      .tk-guard h4 {
        margin: 0 0 8px 0;
        font-size: 1.02rem;
        letter-spacing: .2px;
        color: #e9f4ff;
        text-shadow: 0 0 8px rgba(120, 200, 255, .35);
      }
      .tk-guard p {
        margin: 4px 0;
        color: #cfe6ff;
        opacity: .95;
      }
      .tk-guard .tk-guard-grid {
        display: grid;
        grid-template-columns: 1.1fr 1.1fr;
        gap: 10px 14px;
        margin-top: 10px;
      }
      .tk-pill {
        display: flex; align-items: center; gap: 8px;
        padding: 8px 12px; border-radius: 999px;
        background: #0e1218; color: #dbefff;
        border: 1px solid rgba(255,255,255,0.08);
        box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset;
        font-size: .95rem;
      }
      .tk-dot { width: 12px; height: 12px; border-radius: 999px; box-shadow: 0 0 10px currentColor; }
      .tk-red .tk-dot    { color:#ff5a6a; background:#ff5a6a; }
      .tk-yellow .tk-dot { color:#ffd34a; background:#ffd34a; }
      .tk-grey .tk-dot   { color:#9aa7b1; background:#9aa7b1; }
      .tk-blue .tk-dot   { color:#53c0ff; background:#53c0ff; }

      .tk-legend-box {
        margin-top: 12px;
        padding: 10px 12px;
        border-radius: 12px;
        background: #0c1420;
        border: 1px solid rgba(120,200,255,.22);
        box-shadow: 0 0 0 1px rgba(120,200,255,.16) inset, 0 0 12px rgba(50,170,255,.22);
      }
      .tk-legend {
        display: grid;
        grid-template-columns: repeat(2, minmax(220px, 1fr));
        gap: 10px 14px;
      }

      /* 0–5 chips */
      .tk-chip-row { display:flex; gap:10px; margin:8px 0 6px; }
      .tk-chip {
        display:inline-flex; align-items:center; justify-content:center;
        width: 44px; height: 44px;
        border-radius: 10px; cursor:pointer; user-select:none;
        background:#0e1218; color:#dbefff; font-weight:700;
        border:1px solid rgba(120,200,255,.22);
        box-shadow: 0 0 10px rgba(80,170,255,.16) inset, 0 0 12px rgba(50,170,255,.22);
        transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
      }
      .tk-chip:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 12px rgba(80,170,255,.22) inset, 0 0 16px rgba(50,170,255,.30);
      }
      .tk-chip.is-active {
        background:#111a24; border-color:rgba(120,200,255,.42);
        box-shadow: 0 0 14px rgba(80,170,255,.28) inset, 0 0 18px rgba(50,170,255,.38);
      }
    `;
    document.head.appendChild(style);
  }

  // ---------- 2) Find current question + enhance ----------
  function enhance() {
    // Find something reliable in your question block
    const rateLabel = Array.from(document.querySelectorAll('*'))
      .find(n => /Rate\s*interest\/comfort\s*\(0–?5\)/i.test(n.textContent || ''));

    if (!rateLabel) return;

    // The existing card element to glow
    const card = rateLabel.closest('div');
    if (!card) return;
    card.classList.add('tk-question-card');

    // Insert the Question Guard once per card
    if (!card.querySelector('.tk-guard')) {
      const guard = document.createElement('div');
      guard.className = 'tk-guard';
      guard.innerHTML = `
        <h4>Question Guard: How to use this scale</h4>
        <p><strong>Soft Limit</strong> (yellow): You might do it with conditions—more caution, slower pace, explicit check-ins, and an easy out.</p>
        <p><strong>Willing to Try</strong> (blue): You’re open and curious. You still want boundaries and consent steps, but there’s a gentle green-ish light to experiment.</p>
        <div class="tk-legend-box">
          <div class="tk-legend">
            <div class="tk-pill tk-red"><span class="tk-dot"></span><strong>Hard Limit</strong> — full stop</div>
            <div class="tk-pill tk-yellow"><span class="tk-dot"></span><strong>Soft Limit</strong> — yellow light, go slow & check-in</div>
            <div class="tk-pill tk-grey"><span class="tk-dot"></span><strong>Not Interested</strong> — no thanks</div>
            <div class="tk-pill tk-blue"><span class="tk-dot"></span><strong>Willing to Try</strong> — curious with care</div>
          </div>
        </div>
      `;
      // Put the guard near the top of the card (just under the section title if present)
      const firstPara = card.firstElementChild?.nextElementSibling || card.firstElementChild;
      (firstPara || card).insertAdjacentElement('afterend', guard);
    }

    // Build glowing chips if not present
    const wrapper = rateLabel.parentElement;
    if (wrapper && !wrapper.querySelector('.tk-chip-row')) {
      // Find existing 0–5 buttons if they exist
      let btns = Array.from(wrapper.querySelectorAll('button, .btn, [role="button"]'))
        .filter(b => /^\s*[0-5]\s*$/.test(b.textContent || ''));

      // Create canonical 0–5 if none found
      if (btns.length === 0) {
        btns = Array.from({ length: 6 }, (_, i) => {
          const b = document.createElement('button');
          b.type = 'button'; b.textContent = String(i); b.dataset.tkValue = String(i);
          return b;
        });
      }

      const row = document.createElement('div');
      row.className = 'tk-chip-row';

      btns.forEach(btn => {
        const value = (btn.dataset?.tkValue ?? btn.textContent ?? '').trim();
        const chip = document.createElement('div');
        chip.className = 'tk-chip';
        chip.textContent = value;
        if (value === '0') chip.title = '0 — brain did a cartwheel; skipped this one';

        chip.addEventListener('click', () => {
          row.querySelectorAll('.tk-chip').forEach(c => c.classList.remove('is-active'));
          chip.classList.add('is-active');
          // Sync underlying control if it exists
          if (btn.click) btn.click();
        });
        row.appendChild(chip);
      });

      rateLabel.insertAdjacentElement('afterend', row);
    }
  }

  // Run now and on changes (Next/Back)
  enhance();
  const mo = new MutationObserver(() => {
    clearTimeout(mo._t);
    mo._t = setTimeout(enhance, 60);
  });
  mo.observe(document.body, { childList: true, subtree: true });
})();
</script>
