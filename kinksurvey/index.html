<!doctype html>
<html lang="en" class="theme-dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TalkKink â€” Kink Survey</title>

    <script>
      // hard reset flags that old code checks
      window.__TK_DISABLE_OVERLAY = true;
      window.__TK_DISABLE_PORTAL = true;
      window.__TK_DISABLE_DRAWER = true;

      // if a legacy boot still runs, neutralize its methods safely
      (function(){
        const noop = ()=>{};
        const g = window;
        const suspects = [
          'tkPanelBoot','tkPortalBoot','tkOverlayBoot',
          'tkDockLayout','tkLockPanel','tkOpenPanel','tkWirePanel'
        ];
        suspects.forEach(k => { if (k in g) g[k] = noop; });
        // remove any pre-existing overlay nodes if injected before this executes
        const killNodes = () => {
          document.querySelectorAll('#tkPortal,.tk-overlay,.tk-drawer,.tk-panel,.portal-overlay')
            .forEach(n => n.remove());
        };
        document.addEventListener('DOMContentLoaded', killNodes);
        new MutationObserver(killNodes).observe(document.documentElement,{childList:true,subtree:true});
      })();
    </script>

    <link rel="stylesheet" href="/assets/css/kinksurvey/survey.css?v=2025-10-15">
    <script defer src="/assets/js/kinksurvey/survey.js?v=2025-10-15"></script>
  </head>
  <body>
    <header id="tkHeader">
      <h1>TalkKink Survey</h1>
      <div id="themeControls">
        <button data-theme="dark">Dark</button>
        <button data-theme="lipstick">Lipstick</button>
        <button data-theme="forest">Forest</button>
      </div>
    </header>

    <aside id="categoryPanel" aria-label="Categories">
      <div class="panel-header">
        <h2>Categories</h2>
        <div id="selectedCountBadge" aria-live="polite">0 selected</div>
      </div>
      <div id="categoryChecklist" class="scroll"></div>
    </aside>

    <main id="surveyApp" aria-live="polite">
      <section id="controls">
        <div class="uploader">
          <label>Load Partner A <input id="loadA" type="file" accept=".json"></label>
          <label>Load Partner B <input id="loadB" type="file" accept=".json"></label>
          <button id="downloadA">Download A</button>
          <button id="downloadB">Download B</button>
          <button id="resetAll">Reset</button>
          <button id="exportPDF">Export PDF</button>
        </div>
        <div id="ndProgress">
          <div id="progressBar"><span id="progressPct">0%</span></div>
          <div id="progressText">Question 0 of 0</div>
        </div>
      </section>

      <section id="questionArea">
        <div id="roleTabs" role="tablist" aria-label="Roles">
          <button role="tab" data-role="Giving" aria-selected="true">Giving</button>
          <button role="tab" data-role="Receiving">Receiving</button>
          <button role="tab" data-role="General">General</button>
        </div>
        <article id="questionCard">
          <div id="questionPath" class="muted"></div>
          <h3 id="questionText"></h3>
          <div id="ratingRow">
            <div class="col"><div class="label">Partner A</div><div class="scoreRow" data-partner="A"></div></div>
            <div class="col center">
              <div class="compatWrap">
                <div class="compatBar" id="compatBar"><span id="compatText">N/A</span></div>
                <div id="flagRow" aria-hidden="true"></div>
              </div>
            </div>
            <div class="col"><div class="label">Partner B</div><div class="scoreRow" data-partner="B"></div></div>
          </div>
          <div id="navRow"><button id="prevBtn">Back</button><button id="nextBtn">Next</button></div>
        </article>
      </section>
    </main>
  </body>
</html>
