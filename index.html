<!doctype html>
<html lang="en" class="theme-azure">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Cache-buster -->
  <script>window.TK_VER = 'ks-20241020b';</script>

  <!-- Base styles + neon survey styles -->
  <link rel="stylesheet" href="/css/style.css?v=ks-20241020b">
  <link rel="stylesheet" href="/css/tk_survey_neon.css?v=ks-20241020b">

  <!-- Inline SVG favicon (no binary needed) -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="10" fill="%2300aaff"/><text x="50%25" y="56%25" font-size="34" text-anchor="middle" fill="white" font-family="Segoe UI, Roboto, Arial">TK</text></svg>'>

  <title>Talk Kink Survey</title>
</head>
<body>

  <!-- NEW SHELL (from talk-kink-new-survey.html) -->
  <div id="tkPortal">
    <aside id="categoryPanel" aria-label="Categories"></aside>

    <main id="surveyApp">
      <header class="header-grid">
        <h1 id="pageTitle" class="glow-title">Talk Kink Survey</h1>
        <div class="theme-controls">
          <button class="theme-btn is-active" data-theme="azure">Blue Glow</button>
          <button class="theme-btn" data-theme="dark">Dark</button>
          <button class="theme-btn" data-theme="lipstick">Lipstick</button>
          <button class="theme-btn" data-theme="forest">Forest</button>
        </div>
      </header>

      <!-- Host grid for left question + right rating rail -->
      <section id="tk-question-host" class="tk-dual">
        <article id="tk-question-card" class="tk-pane" aria-live="polite"></article>
        <aside id="tk-rating-card" class="tk-pane" aria-label="Rating"></aside>
      </section>

      <!-- Button rail -->
      <div class="button-grid compatibility-button-container" id="tk-actions"></div>
    </main>
  </div>

  <!-- App logic + enhancer (make sure versions are bumped) -->
  <script defer src="/js/survey.js?v=ks-20241020b"></script>
  <script defer src="/js/tk_kinksurvey_enhance.js?v=ks-20241020b"></script>

  <!-- Bootstrap: wire hooks and dock layout after DOM + data -->
  <script>
    (function boot(){
      const onReady = (fn) => (document.readyState === 'loading')
        ? document.addEventListener('DOMContentLoaded', fn, {once:true}) : fn();

      // Required hooks for custom rendering (if your app exports these)
      window.buildCategoryList && onReady(() => {
        // survey.js should fetch data then call buildCategoryList(data)
      });

      onReady(() => {
        // Docked layout: move category panel + actions into the neon shell
        if (window.setupDockedSurveyLayout) {
          setupDockedSurveyLayout(); // calls ensureDockLayoutNodes(), mountDockPanel(), mountDockActions()
        }
        // Render first question with our card if available
        window.renderFirstQuestion && renderFirstQuestion();
        // Start flow hook remains the same
        window.startSurvey && startSurvey;
      });
    })();
  </script>
</body>
</html>
