// Lightweight jsPDF-compatible implementation used for offline testing
// and basic PDF generation. This is **not** the full jsPDF build but
// provides the minimal subset of the API required by the project.

(function (g) {
  class SimplePDF {
    constructor() {
      this.lines = [];
      this.internal = {
        pageSize: {
          getWidth: () => 210,
          getHeight: () => 297,
        },
      };
    }

    setFillColor() {}
    rect() {}
    setDrawColor() {}
    line() {}
    setTextColor() {}
    setFont() {}
    setFontSize() {}
    text(t) {
      this.lines.push(t);
    }
    addPage() {}

    // Very small PDF generator â€“ supports text output only
    save(filename = 'document.pdf') {
      const esc = (s) =>
        (s || '').replace(/([\\()\n\r])/g, (r) => ({
          '\\': '\\\\',
          '(': '\\(',
          ')': '\\)',
          '\n': '\\n',
          '\r': '',
        }[r]));

      const header = '%PDF-1.1\n';
      const objects = [];
      const content = `BT /F1 12 Tf 72 720 Td (${esc(
        this.lines.join('\n')
      )}) Tj ET`;
      const stream = `<< /Length ${content.length} >>\nstream\n${content}\nendstream`;
      objects.push(stream);
      objects.push('<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>');
      objects.push(
        '<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Resources << /Font << /F1 2 0 R >> >> /Contents 1 0 R >>'
      );
      objects.push('<< /Type /Pages /Kids [3 0 R] /Count 1 >>');
      objects.push('<< /Type /Catalog /Pages 4 0 R >>');

      let body = header;
      const offsets = [0];
      objects.forEach((obj, i) => {
        offsets.push(body.length);
        body += `${i + 1} 0 obj\n${obj}\nendobj\n`;
      });
      const xref = body.length;
      body += `xref\n0 ${objects.length + 1}\n`;
      offsets.forEach((off) => {
        body += off.toString().padStart(10, '0') + ' 00000 n \n';
      });
      body += `trailer\n<< /Size ${objects.length + 1} /Root ${objects.length} 0 R >>\nstartxref\n${xref}\n%%EOF`;

      const blob = new Blob([body], { type: 'application/pdf' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  }

  g.jspdf = { jsPDF: SimplePDF };
})(typeof window !== 'undefined' ? window : globalThis);

