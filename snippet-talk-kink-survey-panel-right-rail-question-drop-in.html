<!-- ===================== TALK KINK — QUESTION + SCORE GUIDE ===================== -->
<style>
  /* Layout */
  .survey-root {
    display: grid;
    grid-template-columns: 320px 1fr 340px; /* left • center • right */
    gap: 16px;
    align-items: start;
  }
  .categories { min-height: 60vh; }

  /* Question Card */
  .survey-question-panel .question-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 16px;
  }
  .q-head   { margin-bottom: 8px; }
  .q-path   { opacity:.75; font-size:.9rem; margin-bottom: 4px; }
  .q-title  { margin:0 0 8px; font-size:1.25rem; }
  .label    { font-weight:600; margin-top:6px; }
  #tk-guard { margin-top:6px; min-height:1.2em; opacity:.8; }

  /* Keep ONLY sidebar How-to-score visible */
  .score-sidebar .how-to-score,
  .how-to-score--sidebar { display:block; }
  .survey-question-panel .how-to-score,
  #question-panel .how-to-score,
  .how-to-score--inline { display:none !important; }

  /* Rating grids (0–5 buttons) */
  .rating-grid, #tk-scale {
    display:grid;
    grid-template-columns: repeat(6, minmax(42px, 1fr));
    gap:10px;
    margin-top:10px;
  }
  .rating-grid button, #tk-scale button {
    border:1px solid rgba(255,255,255,.14);
    border-radius:12px;
    padding:10px 0;
    background:transparent;
    color:inherit;
    cursor:pointer;
    font-size:16px;
  }
  button.option.selected { outline:2px solid currentColor; transform:translateY(-1px); }
  button.option[aria-pressed="true"] { font-weight:700; }

  /* Sidebar box */
  .score-sidebar .how-to-score {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 14px;
  }
  .how-to-score h3 { margin:0 0 8px; font-size:1.05rem; }
  .how-to-score .legend { list-style:none; padding:0; margin:0; display:grid; gap:8px; }
  .how-to-score .legend li { background: rgba(255,255,255,.04); border-radius:12px; padding:10px; }
  .score-sidebar .rating-box { margin-top:12px; padding-top:10px; border-top:1px solid rgba(255,255,255,.08); }
</style>

<!-- PAGE BODY -->
<main class="survey-root" id="tk-app" hidden>
  <!-- LEFT: categories (your existing list goes here or is injected) -->
  <aside class="categories" id="tk-categories">
    <!-- … existing categories UI (or leave empty for JS to fill) … -->
  </aside>

  <!-- CENTER: Question Panel (we inject a Question Card every render) -->
  <section id="question-panel" class="survey-question-panel"></section>

  <!-- RIGHT: Sidebar Score Guide + compact rating scale -->
  <aside class="score-sidebar" data-sticky="score">
    <section class="how-to-score how-to-score--sidebar" id="tk-score-guide">
      <h3>How to score</h3>
      <ul class="legend">
        <li><b>0</b> — Brain did a cartwheel (skip for now)</li>
        <li><b>1</b> — Hard Limit (no-go)</li>
        <li><b>2</b> — Soft Limit (willing to try…)</li>
        <li><b>3</b> — Curious / context-dependent</li>
        <li><b>4</b> — Comfortable / enjoy</li>
        <li><b>5</b> — Favorite / enthusiastic yes</li>
      </ul>
      <div class="rating-box">
        <div class="label">Rate interest/comfort (0–5)</div>
        <div class="rating-grid" id="tk-scale-sidebar" data-group="rating-A"></div>
      </div>
    </section>
  </aside>
</main>

<!-- START PAGE (your existing landing with buttons) -->
<section id="tk-landing">
  <!-- your buttons already exist; we just hook Start Survey below -->
  <!-- Example:
  <button id="btnStart">Start Survey</button>
  -->
</section>

<script>
/* ====================== CORE RENDER + HANDLERS ======================= */
(function(){
  // ---- util: make a 0–5 scale into a container ----
  function makeScaleButtons(container, groupKey='rating-A') {
    if (!container) return;
    container.dataset.group = groupKey;
    container.innerHTML = '';
    for (let i=0; i<=5; i++) {
      const b = document.createElement('button');
      b.className = 'option';
      b.type = 'button';
      b.dataset.value = String(i);
      b.textContent = String(i);
      b.setAttribute('aria-pressed','false');
      container.appendChild(b);
    }
  }

  // ---- render the center Question Card ----
  function renderQuestionCard({category='Appearance Play', prompt='Choosing My Partner S', role='Giving'}={}) {
    const panel = document.getElementById('question-panel');
    panel.innerHTML = `
      <article class="question-card">
        <header class="q-head">
          <div class="q-path">${category} • ${prompt}</div>
          <h2 class="q-title">${role}: Rate interest/comfort (0–5)</h2>
        </header>

        <div id="ratingRow" class="single">
          <div class="col">
            <div class="label">Rate interest/comfort (0–5)</div>
            <div id="tk-guard" aria-live="polite"></div>
            <div id="tk-scale" data-group="rating-A"></div>
            <div class="scoreRow" data-partner="A" data-group="rating-A"></div>
          </div>
        </div>

        <!-- Inline score guide is present but auto-hidden by CSS -->
        <section class="how-to-score how-to-score--inline">
          <h3>How to score</h3>
          <ul class="legend">
            <li><b>0</b> — Brain did a cartwheel (skip for now)</li>
            <li><b>1</b> — Hard Limit (no-go)</li>
            <li><b>2</b> — Soft Limit (willing to try…)</li>
            <li><b>3</b> — Curious / context-dependent</li>
            <li><b>4</b> — Comfortable / enjoy</li>
            <li><b>5</b> — Favorite / enthusiastic yes</li>
          </ul>
        </section>
      </article>
    `;

    // Build 0–5 scales (center + right)
    makeScaleButtons(document.getElementById('tk-scale'), 'rating-A');
    makeScaleButtons(document.getElementById('tk-scale-sidebar'), 'rating-A');
  }

  // ---- click handling (delegated) & sync both grids ----
  function bindRatingHandler() {
    const root = document.querySelector('.survey-root') || document.body;
    const state = {};
    root.addEventListener('click', (e) => {
      const btn = e.target.closest('button.option');
      if (!btn) return;

      // prevent submit behavior if any
      if (!btn.type || btn.type.toLowerCase() === 'submit') btn.type = 'button';

      const group = btn.closest('[data-group]');
      if (!group) return;
      const groupKey = group.dataset.group || 'default';
      const value = btn.dataset.value ?? btn.value ?? btn.textContent.trim();

      // toggle selection across ALL grids with same group
      document.querySelectorAll(`[data-group="${groupKey}"] button.option`).forEach(b => {
        const on = (b.dataset.value === value);
        b.classList.toggle('selected', on);
        b.setAttribute('aria-pressed', on ? 'true' : 'false');
      });

      state[groupKey] = value;
      const guard = document.getElementById('tk-guard');
      if (guard) guard.textContent = `Selected ${value} of 5`;
      console.log('[Survey Selected]', { group: groupKey, value });
    }, false);
  }

  // ---- Initialize the survey screen (called after Start Survey) ----
  function showSurveyScreen() {
    // hide landing, show app shell
    document.getElementById('tk-landing')?.setAttribute('hidden', 'hidden');
    document.getElementById('tk-app')?.removeAttribute('hidden');

    // Render first question card + ensure sidebar is present
    renderQuestionCard({
      category: window.tkCurrentCategory || 'Appearance Play',
      prompt:   window.tkCurrentPrompt   || 'Choosing My Partner S',
      role:     window.tkCurrentRole     || 'Giving'
    });
  }

  // ---- Hook Start Survey button ----
  function wireStartButton() {
    const btn = document.querySelector('#btnStart, button[data-action="start"], a[data-action="start"]');
    if (!btn) return;
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      showSurveyScreen();
    });
  }

  // ---- Boot ----
  document.addEventListener('DOMContentLoaded', () => {
    bindRatingHandler();
    wireStartButton();
    // If you want the survey to show immediately (skip landing), uncomment:
    // showSurveyScreen();
  });

  // Expose for your existing code (if you render next question elsewhere)
  window.tkRenderQuestionCard = renderQuestionCard;
  window.tkShowSurveyScreen  = showSurveyScreen;
})();
</script>
<!-- =================== END — QUESTION + SCORE GUIDE RESTORE ==================== -->
