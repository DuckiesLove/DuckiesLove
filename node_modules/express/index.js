import http from 'http';

export default function express() {
  const middlewares = [];
  return {
    use(fn) {
      middlewares.push(fn);
    },
    listen(port, cb) {
      const server = http.createServer((req, res) => {
        let i = 0;
        const next = () => {
          const mw = middlewares[i++];
          if (mw) {
            mw(req, res, next);
          } else {
            res.end();
          }
        };
        next();
      });
      return server.listen(port, cb);
    },
  };
}
