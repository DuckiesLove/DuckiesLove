import { readFileSync } from 'fs';

export function config(options = {}) {
  const path = options.path || '.env';
  try {
    const content = readFileSync(path, 'utf8');
    content.split(/\r?\n/).forEach(line => {
      const match = line.match(/^\s*([A-Za-z_][A-Za-z0-9_]*)\s*=\s*(.*)\s*$/);
      if (match) {
        const key = match[1];
        let value = match[2].replace(/^['"]|['"]$/g, '');
        if (!Object.prototype.hasOwnProperty.call(process.env, key)) {
          process.env[key] = value;
        }
      }
    });
    return { parsed: process.env };
  } catch {
    return { parsed: {} };
  }
}

export default { config };
